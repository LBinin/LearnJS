### Set

> ES6 æä¾›äº†æ–°çš„æ•°æ®ç»“æ„ Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰ã€Œé‡å¤çš„å€¼ã€ã€‚

Set æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Set æ•°æ®ç»“æ„ï¼š

```javascript
const s = new Set()

[2, 3, 5, 4, 5, 2, 2].forEach(x => s.add(x))

for (let i of s) {
  console.log(i)
}
// 2 3 5 4
```

Set å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼ˆ æˆ–è€…å…·æœ‰ iterable æ¥å£çš„å…¶ä»–æ•°æ®ç»“æ„ ï¼‰ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–ï¼š

```javascript
// ä¾‹ä¸€
const set = new Set([1, 2, 3, 4, 4])
[...set] // [1, 2, 3, 4]

// ä¾‹äºŒ
const items = new Set([1, 2, 3, 4, 5, 5, 5, 5])
items // {1, 2, 3, 4, 5}

// ä¾‹ä¸‰
function divs () {
  return [...document.querySelectorAll('div')]
}

const set = new Set(divs())
set.size // 56

// ç±»ä¼¼äº
divs().forEach(div => set.add(div))
set.size // 56
```

åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæä¾›äº†ä¸€ç§å»é™¤æ•°ç»„é‡å¤æˆå‘˜çš„æ–¹æ³•ï¼šæ¯”å¦‚ï¼š

```javascript
var array = [1, 1, 2, 2, 3, 3, 4, 5, 5, 5, 5, 5]
[...new Set(array)] // [1, 2, 3, 4, 5]
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå‘ Set åŠ å…¥å€¼çš„æ—¶å€™ï¼Œä¸ä¼šå‘ç”Ÿã€Œç±»å‹è½¬æ¢ã€ï¼Œæ‰€ä»¥ `5` å’Œ `"5"` æ˜¯ä¸¤ä¸ªä¸åŒçš„å€¼ã€‚

Set å†…éƒ¨åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸åŒï¼Œä½¿ç”¨çš„ç®—æ³•å«åšã€ŒSame-value equalityã€ï¼Œå®ƒç±»ä¼¼äºç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ `===` ï¼‰ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯ `NaN` ç­‰äºè‡ªèº«ï¼Œè€Œç²¾ç¡®ç›¸ç­‰è¿ç®—ç¬¦è®¤ä¸º `NaN` ä¸ç­‰äºè‡ªèº«ã€‚

å¦å¤–ï¼Œä¸¤ä¸ªå¯¹è±¡æ€»æ˜¯ä¸ç›¸ç­‰çš„ã€‚

```javascript
let set = new Set()
set.add(NaN)
set.add(NaN)
set.add(5)
set.add('5')
set.add({})
set.add({})
set // {NaN, 5, "5", {â€¦}, {â€¦}}
```

---

### Set å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•

**Set ç±»å‹çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ï¼š**

- `Set.prototype.constructor`ï¼šæ„é€ å‡½æ•°ï¼Œé»˜è®¤å°±æ˜¯ `Set` å‡½æ•°ã€‚
- `Set.prototype.size`ï¼šè¿”å› `Set` å®ä¾‹çš„æˆå‘˜æ€»æ•°ã€‚

**Set ç±»å‹çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ï¼š**

Set å®ä¾‹çš„æ–¹æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼šæ“ä½œæ–¹æ³•ï¼ˆ ç”¨äºæ“ä½œæ•°æ® ï¼‰å’Œéå†æ–¹æ³•ï¼ˆ ç”¨äºéå†æˆå‘˜ ï¼‰ã€‚ä¸‹é¢å…ˆä»‹ç»å››ä¸ªæ“ä½œæ–¹æ³•ã€‚

- `add(value)`ï¼šæ·»åŠ æŸä¸ªå€¼ï¼Œè¿”å›ã€ŒSet ç»“æ„æœ¬èº«ã€ã€‚
- `delete(value)`ï¼šåˆ é™¤æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªã€Œå¸ƒå°”å€¼ã€ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸã€‚
- `has(value)`ï¼šè¿”å›ä¸€ä¸ªã€Œå¸ƒå°”å€¼ã€ï¼Œè¡¨ç¤ºè¯¥å€¼æ˜¯å¦ä¸º Set çš„æˆå‘˜ã€‚
- `clear()`ï¼šæ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚

```javascript
s.add(1).add(2).add(2) // {1, 2}
// æ³¨æ„ 2 è¢«åŠ å…¥äº†ä¸¤æ¬¡

s.size // 2

s.has(1) // true
s.has(2) // true
s.has(3) // false

s.delete(2)
s.has(2) // false

s.clear()
s.size // 0
```

`Array.from` æ–¹æ³•å¯ä»¥å°† Set ç»“æ„è½¬ä¸ºæ•°ç»„ï¼š

```javascript
const items = new Set([1, 2, 3, 4, 5])
const array = Array.from(items)
```

---

### Set çš„éå†æ“ä½œ

- `keys()`ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚
- `values()`ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚
- `entries()`ï¼šè¿”å›é”®å€¼å¯¹çš„éå†å™¨ã€‚
- `forEach()`ï¼šä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSet çš„éå†é¡ºåºå°±æ˜¯æ’å…¥é¡ºåºã€‚è¿™ä¸ªç‰¹æ€§æœ‰æ—¶éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä½¿ç”¨ Set ä¿å­˜ä¸€ä¸ªå›è°ƒå‡½æ•°åˆ—è¡¨ï¼Œè°ƒç”¨æ—¶å°±èƒ½ä¿è¯æŒ‰ç…§æ·»åŠ é¡ºåºè°ƒç”¨ã€‚

#### keys()ï¼Œvalues()ï¼Œentries()

`keys` æ–¹æ³•ã€`values` æ–¹æ³•ã€`entries` æ–¹æ³•è¿”å›çš„éƒ½æ˜¯ã€Œéå†å™¨å¯¹è±¡ã€ï¼ˆ è¯¦è§ [Iterator](./Iteratorå’Œfor...ofå¾ªç¯.md) ä¸€ç« ï¼‰ã€‚

ç”±äº Set ç»“æ„æ²¡æœ‰é”®åï¼Œåªæœ‰é”®å€¼ï¼ˆ æˆ–è€…å¯ä»¥è¯´é”®åå’Œé”®å€¼æ˜¯åŒä¸€ä¸ªå€¼ ï¼‰ï¼Œæ‰€ä»¥ `keys` æ–¹æ³•å’Œ `values` æ–¹æ³•çš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚

```javascript
var set = new Set(['red', 'green', 'blue'])

for (let item of set.keys()) {
  console.log(item)
}
// red
// green
// blue

for (let item of set.values()) {
  console.log(item)
}
// red
// green
// blue

for (let item of set.entries()) {
  console.log(item)
}
// ["red", "red"]
// ["green", "green"]
// ["blue", "blue"]
```

å¯ä»¥çœ‹åˆ°ï¼Œ`entries` æ–¹æ³•è¿”å›çš„ã€Œéå†å™¨ã€ï¼ŒåŒæ—¶åŒ…æ‹¬**é”®å**å’Œ**é”®å€¼**ï¼Œæ‰€ä»¥æ¯æ¬¡è¾“å‡ºä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„ä¸¤ä¸ªæˆå‘˜å®Œå…¨ç›¸ç­‰ã€‚

Set ç»“æ„çš„å®ä¾‹é»˜è®¤å¯éå†ï¼Œå®ƒçš„é»˜è®¤éå†å™¨ç”Ÿæˆå‡½æ•°å°±æ˜¯å®ƒçš„ `values` æ–¹æ³•ï¼š

```javascript
Set.prototype[Symbol.iterator] === Set.prototype.values // true
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨çš„æ—¶å€™å¯ä»¥çœç•¥ `values` æ–¹æ³•ï¼Œç›´æ¥ç”¨ `for...of` å¾ªç¯éå† Setï¼š

```javascript
let set = new Set(['red', 'green', 'blue'])

for (let x of set) {
  console.log(x)
}
// red
// green
// blue
```

å› ä¸º `for...of` è°ƒç”¨çš„æ•°æ®ç»“æ„çš„  terator æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`for...of` å¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„ `Symbol.iterator` æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥çœç•¥ `values()`ã€‚

#### forEach()

Set ç»“æ„çš„å®ä¾‹ä¸æ•°ç»„ä¸€æ ·ï¼Œä¹Ÿæ‹¥æœ‰ `forEach` æ–¹æ³•ï¼Œç”¨äºå¯¹æ¯ä¸ªæˆå‘˜æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿä¸å¯æ‰“æ–­ã€‚æ¯”å¦‚ï¼š

```javascript
set = new Set([1, 4, 9])
set.forEach((value, key) => console.log(key + ' : ' + value))
// 1 : 1
// 4 : 4
// 9 : 9
```

è¿™é‡Œéœ€è¦æ³¨æ„ï¼ŒSet ç»“æ„çš„é”®åå°±æ˜¯ã€Œé”®å€¼ã€ï¼ˆ ä¸¤è€…æ˜¯åŒä¸€ä¸ªå€¼ ï¼‰ï¼Œå› æ­¤**ç¬¬ä¸€ä¸ªå‚æ•°**ä¸**ç¬¬äºŒä¸ªå‚æ•°**çš„å€¼æ°¸è¿œéƒ½æ˜¯ä¸€æ ·çš„ã€‚

#### éå†çš„åº”ç”¨

1. æ‰©å±•è¿ç®—ç¬¦ï¼ˆ `...` ï¼‰å†…éƒ¨ä½¿ç”¨ `for...of` å¾ªç¯ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç”¨äº Set ç»“æ„ï¼š

    ```javascript
    var set = new Set(['red', 'green', 'blue'])
    var arr = [...set] // ['red', 'green', 'blue']
    ```

2. æ‰©å±•è¿ç®—ç¬¦å’Œ Set ç»“æ„ç›¸ç»“åˆï¼Œå°±å¯ä»¥å»é™¤æ•°ç»„çš„é‡å¤æˆå‘˜ã€‚

    ```javascript
    var arr = [1, 2, 3, 4, 5, 5, 5]
    var unique = [...new Set(arr)] // [1, 2, 3, 4, 5]
    ```

3. æ•°ç»„çš„ `map` å’Œ `filter` æ–¹æ³•ä¹Ÿå¯ä»¥é—´æ¥ç”¨äº Set äº†ï¼Œç›¸å½“äºå…ˆæŠŠ Set è½¬æ¢æˆæ•°ç»„ç»“æ„ï¼Œç„¶ååœ¨ç”¨ Set çš„æ„é€ å‡½æ•°ã€‚

    ```javascript
    let set = new Set([1, 2, 3])
    set = new Set([...set].map(x => x * 2))
    // è¿”å›Setç»“æ„ï¼š{2, 4, 6}

    let set = new Set([1, 2, 3, 4, 5])
    set = new Set([...set].filter(x => (x % 2) == 0))
    // è¿”å›Setç»“æ„ï¼š{2, 4}
    ```

    æ‰€ä»¥ï¼Œå¦‚æœæƒ³åœ¨éå†æ“ä½œä¸­ï¼ŒåŒæ­¥æ”¹å˜åŸæ¥çš„ Set ç»“æ„ï¼Œç›®å‰æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•ï¼Œä½†æœ‰ä¸¤ç§å˜é€šæ–¹æ³•ã€‚ä¸€ç§æ˜¯åˆ©ç”¨åŸ Set ç»“æ„æ˜ å°„å‡ºä¸€ä¸ªæ–°çš„ç»“æ„ï¼Œç„¶åèµ‹å€¼ç»™åŸæ¥çš„ Set ç»“æ„ï¼›å¦ä¸€ç§æ˜¯åˆ©ç”¨Array.fromæ–¹æ³•ã€‚

    ```javascript
    // æ–¹æ³•ä¸€
    let set = new Set([1, 2, 3])
    set = new Set([...set].map(val => val * 2))
    // setçš„å€¼æ˜¯2, 4, 6

    // æ–¹æ³•äºŒ
    let set = new Set([1, 2, 3])
    set = new Set(Array.from(set, val => val * 2))
    // setçš„å€¼æ˜¯2, 4, 6
    ```

4. ä½¿ç”¨ Set å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å¹¶é›†ï¼ˆ Union ï¼‰ã€äº¤é›†ï¼ˆ Intersect ï¼‰å’Œå·®é›†ï¼ˆ Difference ï¼‰ã€‚

    ```javascript
    var a = new Set([1, 2, 3])
    var b = new Set([4, 3, 2])

    // å¹¶é›†
    var Union = new Set([...a, ...b])
    // Set {1, 2, 3, 4}

    // äº¤é›†
    var Intersect = new Set([...a].filter(value => b.has(value)))
    // set {2, 3}

    // å·®é›†
    var Difference = new Set([...a].filter(value => !b.has(value)))
    // Set {1}
    ```

---

### WeakSet

WeakSet ç»“æ„ä¸ Set ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸é‡å¤çš„å€¼çš„é›†åˆã€‚ä½†æ˜¯ï¼Œå®ƒä¸ Set æœ‰ä¸¤ä¸ªåŒºåˆ«ã€‚

é¦–å…ˆï¼ŒWeakSet çš„**æˆå‘˜**åªèƒ½æ˜¯ã€Œå¯¹è±¡ã€ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼ã€‚

å…¶æ¬¡ï¼ŒWeakSet ä¸­çš„å¯¹è±¡éƒ½æ˜¯ã€Œå¼±å¼•ç”¨ã€ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ WeakSet å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå…¶ä»–å¯¹è±¡éƒ½ä¸å†å¼•ç”¨è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œä¸è€ƒè™‘è¯¥å¯¹è±¡è¿˜å­˜åœ¨äº WeakSet ä¹‹ä¸­ã€‚

è¿™æ˜¯å› ä¸ºåƒåœ¾å›æ”¶æœºåˆ¶ä¾èµ–å¼•ç”¨è®¡æ•°ï¼Œå¦‚æœä¸€ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°ä¸ä¸º0ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šé‡Šæ”¾è¿™å—å†…å­˜ã€‚ç»“æŸä½¿ç”¨è¯¥å€¼ä¹‹åï¼Œæœ‰æ—¶ä¼šå¿˜è®°å–æ¶ˆå¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ï¼Œè¿›è€Œå¯èƒ½ä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚WeakSet é‡Œé¢çš„å¼•ç”¨ï¼Œéƒ½ä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œæ‰€ä»¥å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚

å› æ­¤ï¼ŒWeakSet é€‚åˆä¸´æ—¶å­˜æ”¾ä¸€ç»„å¯¹è±¡ï¼Œä»¥åŠå­˜æ”¾è·Ÿå¯¹è±¡ç»‘å®šçš„ä¿¡æ¯ã€‚åªè¦è¿™äº›å¯¹è±¡åœ¨å¤–éƒ¨æ¶ˆå¤±ï¼Œå®ƒåœ¨ WeakSet é‡Œé¢çš„å¼•ç”¨å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±ã€‚

ç”±äºä¸Šé¢è¿™ä¸ªç‰¹ç‚¹ï¼ŒWeakSet çš„æˆå‘˜æ˜¯ä¸é€‚åˆå¼•ç”¨çš„ï¼Œå› ä¸ºå®ƒä¼šéšæ—¶æ¶ˆå¤±ã€‚å¦å¤–ï¼Œç”±äº WeakSet å†…éƒ¨æœ‰å¤šå°‘ä¸ªæˆå‘˜ï¼Œå–å†³äºåƒåœ¾å›æ”¶æœºåˆ¶æœ‰æ²¡æœ‰è¿è¡Œï¼Œè¿è¡Œå‰åå¾ˆå¯èƒ½æˆå‘˜ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ï¼Œè€Œåƒåœ¾å›æ”¶æœºåˆ¶ä½•æ—¶è¿è¡Œæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå› æ­¤ ES6 è§„å®š WeakSetã€Œä¸å¯éå†ã€ã€‚

#### è¯­æ³•

å’Œ Set ç±»ä¼¼ï¼ŒWeakSet æ˜¯ä¸€ä¸ªã€Œæ„é€ å‡½æ•°ã€ï¼Œå¯ä»¥ä½¿ç”¨ `new` å‘½ä»¤ï¼Œåˆ›å»º WeakSet æ•°æ®ç»“æ„ï¼š

```javascript
const ws = new WeakSet()
```

æ­¤å¤–ï¼ŒWeakSet å¯ä»¥æ¥å—ä¸€ä¸ªã€Œæ•°ç»„ã€æˆ–ã€Œç±»æ•°ç»„å¯¹è±¡ã€ä½œä¸ºå‚æ•°ã€‚ï¼ˆ å®é™…ä¸Šï¼Œä»»ä½•å…·æœ‰ Iterable æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½œä¸º WeakSet çš„å‚æ•° ï¼‰è¯¥æ•°ç»„çš„æ‰€æœ‰æˆå‘˜ï¼Œéƒ½ä¼šè‡ªåŠ¨æˆä¸º WeakSet å®ä¾‹å¯¹è±¡çš„æˆå‘˜ï¼š

```javascript
const a = [[1, 2], [3, 4]]
const ws = new WeakSet(a)
// WeakSet {[1, 2], [3, 4]}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š`a` æ•°ç»„çš„æˆå‘˜æˆä¸º WeakSet çš„æˆå‘˜ï¼Œè€Œä¸æ˜¯ `a` æ•°ç»„æœ¬èº«ã€‚è¿™æ„å‘³ç€ï¼Œæ•°ç»„çš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ã€‚

#### WeakSet çš„é™æ€æ–¹æ³•

- `WeakSet.prototype.add(value)`ï¼šå‘ WeakSet å®ä¾‹æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ï¼Œè¿”å›ã€ŒWeekSet ç»“æ„æœ¬èº«ã€ã€‚
- `WeakSet.prototype.delete(value)`ï¼šæ¸…é™¤ WeakSet å®ä¾‹çš„æŒ‡å®šæˆå‘˜ï¼Œè¿”å›ä¸€ä¸ªã€Œå¸ƒå°”å€¼ã€ï¼Œè¡¨ç¤ºæ˜¯å¦åˆ é™¤æˆåŠŸã€‚
- `WeakSet.prototype.has(value)`ï¼šè¿”å›ä¸€ä¸ªã€Œå¸ƒå°”å€¼ã€ï¼Œè¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦åœ¨ WeakSet å®ä¾‹ä¹‹ä¸­ã€‚

```javascript
const ws = new WeakSet()
const obj = {}
const foo = {}

ws.add(window)
ws.add(obj)

ws.has(window) // true
ws.has(foo)    // false

ws.delete(window) // true
ws.has(window)    // false
```

#### WeakSet çš„å±æ€§

WeakSet æ²¡æœ‰ `size` å±æ€§ï¼Œä¹Ÿæ²¡æœ‰ `forEach`ï¼Œæ²¡æœ‰åŠæ³•éå†å®ƒçš„æˆå‘˜ã€‚

é‚£è¯´åˆ°åº•ï¼Œè¿™ä¸œè¥¿æœ‰ä»€ä¹ˆç”¨ -=-

é˜®è€å¸ˆä¸¾äº†ä¸€ä¸ªä¾‹å­ï¼š

> WeakSet çš„ä¸€ä¸ªç”¨å¤„ï¼Œæ˜¯å‚¨å­˜ DOM èŠ‚ç‚¹ï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿™äº›èŠ‚ç‚¹ä»æ–‡æ¡£ç§»é™¤æ—¶ï¼Œä¼šå¼•å‘å†…å­˜æ³„æ¼ã€‚

---

### Map

JavaScript çš„å¯¹è±¡ï¼ˆ Object ï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼ˆ Hash ç»“æ„ ï¼‰ï¼Œä½†æ˜¯ä¼ ç»Ÿä¸Šåªèƒ½ç”¨ã€Œå­—ç¬¦ä¸²ã€å½“ä½œé”®ã€‚è¿™ç»™å®ƒçš„ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„é™åˆ¶ã€‚

ES6 æä¾›äº† Map æ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äºå¯¹è±¡ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†æ˜¯ã€Œé”®ã€çš„èŒƒå›´ä¸é™äºå­—ç¬¦ä¸²ï¼Œ**å„ç§ç±»å‹**çš„å€¼ï¼ˆ åŒ…æ‹¬å¯¹è±¡ ï¼‰éƒ½å¯ä»¥å½“ä½œé”®ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼ŒObject ç»“æ„æä¾›äº†ã€Œå­—ç¬¦ä¸² â€” å€¼ã€çš„å¯¹åº”ï¼ŒMap ç»“æ„æä¾›äº†ã€Œå€¼ â€” å€¼ã€çš„å¯¹åº”ï¼Œæ˜¯ä¸€ç§æ›´å®Œå–„çš„ Hash ç»“æ„å®ç°ã€‚å¦‚æœä½ éœ€è¦ã€Œé”®å€¼å¯¹ã€çš„æ•°æ®ç»“æ„ï¼ŒMap æ¯” Object æ›´åˆé€‚ã€‚

```javascript
const m = new Map()
const o = {p: 'Hello World'}

m.set(o, 'content')
m.get(o) // "content"

m.has(o) // true
m.delete(o) // true
m.has(o) // false
```

ä½œä¸ºæ„é€ å‡½æ•°ï¼ŒMap ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªã€Œæ•°ç»„ã€ä½œä¸ºå‚æ•°ï¼šè¯¥æ•°ç»„çš„æˆå‘˜æ˜¯ä¸€ä¸ªä¸ªè¡¨ç¤ºé”®å€¼å¯¹çš„**æ•°ç»„**ã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°

```javascript
const map = new Map([
  ['name', 'å¼ ä¸‰'], // ä¸€ä¸ªæ•°ç»„ä»£è¡¨ä¸€ä¸ªé”®å€¼å¯¹
  ['title', 'Author'] // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®åï¼Œç¬¬äºŒä¸ªæ˜¯é”®å€¼
])

// å®é™…ä¸Šç›¸å½“äºè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œ
const map = new Map()
const items = [
  ['name', 'å¼ ä¸‰'],
  ['title', 'Author']
]
items.forEach( ([key, value]) => map.set(key, value) )


map.size // 2
map.has('name') // true
map.get('name') // "å¼ ä¸‰"
map.has('title') // true
map.get('title') // "Author"
```

äº‹å®ä¸Šï¼Œä¸ä»…ä»…æ˜¯æ•°ç»„ï¼Œä»»ä½•å…·æœ‰ Iterator æ¥å£ã€ä¸”æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ä¸€ä¸ªåŒå…ƒç´ çš„æ•°ç»„çš„æ•°æ®ç»“æ„éƒ½å¯ä»¥å½“ä½œ Map æ„é€ å‡½æ•°çš„å‚æ•°ã€‚è¿™å°±æ˜¯è¯´ï¼ŒSet å’Œ Map éƒ½å¯ä»¥ç”¨æ¥ç”Ÿæˆæ–°çš„ Mapï¼š

```javascript
const set = new Set([
  ['foo', 1],
  ['bar', 2]
]);
const m1 = new Map(set);
m1.get('foo') // 1

const m2 = new Map([['baz', 3]]);
const m3 = new Map(m2);
m3.get('baz') // 3
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåªæœ‰å¯¹ã€ŒåŒä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€ï¼ŒMap ç»“æ„æ‰å°†å…¶è§†ä¸ºåŒä¸€ä¸ªé”®ã€‚è¿™ä¸€ç‚¹è¦éå¸¸å°å¿ƒã€‚

Map çš„é”®å®é™…ä¸Šæ˜¯è·Ÿã€Œå†…å­˜åœ°å€ã€ç»‘å®šçš„ï¼Œåªè¦**å†…å­˜åœ°å€**ä¸ä¸€æ ·ï¼Œå°±è§†ä¸ºä¸¤ä¸ªé”®ã€‚

è¿™å°±è§£å†³äº†åŒåå±æ€§ç¢°æ’ï¼ˆ clash ï¼‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‰©å±•åˆ«äººçš„åº“çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨å¯¹è±¡ä½œä¸ºé”®åï¼Œå°±ä¸ç”¨æ‹…å¿ƒè‡ªå·±çš„å±æ€§ä¸åŸä½œè€…çš„å±æ€§åŒåã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ Symbo :)

å› ä¸ºå†…éƒ¨çš„é”®ååˆ¤æ–­ç±»ä¼¼äºã€Œä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ã€ï¼Œæ‰€ä»¥ï¼Œå¦‚ `true` å’Œ `"true"` æ˜¯ä¸ä¸€æ ·çš„é”®åï¼Œä½†æ˜¯ `NaN` æ˜¯ä¸€æ ·çš„ã€‚å’Œ Set çš„å†…éƒ¨åˆ¤æ–­é‡å¤æ˜¯ä¸€æ ·çš„ç®—æ³•ã€‚

---

### Map å®ä¾‹çš„å±æ€§å’Œæ“ä½œæ–¹æ³•

Map ç»“æ„çš„å®ä¾‹æœ‰ä»¥ä¸‹å±æ€§å’Œæ“ä½œæ–¹æ³•ï¼š

#### 1. size å±æ€§

> è¿”å› Map ç»“æ„çš„æˆå‘˜æ€»æ•°ã€‚

```javascript
const map = new Map()
map.set('foo', true)
map.set('bar', false)

map.size // 2
```

#### 2. set(key, value)

> è®¾ç½®é”®å `key` å¯¹åº”çš„é”®å€¼ä¸º `value`ï¼Œç„¶åè¿”å›æ•´ä¸ª Map ç»“æ„ã€‚å¦‚æœ `key` å·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®ï¼š

```javascript
const m = new Map()

m.set('edition', 6)        // é”®æ˜¯å­—ç¬¦ä¸²
m.set(262, 'standard')     // é”®æ˜¯æ•°å€¼
m.set(undefined, 'nah')    // é”®æ˜¯ undefined
```

å°æŠ€å·§ï¼š`set` æ–¹æ³•è¿”å›çš„æ˜¯å½“å‰çš„ `Map` å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼š

```javascript
let map = new Map()
  .set(1, 'a')
  .set(2, 'b')
  .set(3, 'c')
```

#### 3. get(key)

> è¯»å– `key` å¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ° `key`ï¼Œè¿”å› `undefined`ï¼š

```javascript
const m = new Map()

const hello = function() {console.log('hello')}
m.set(hello, 'Hello ES6!') // é”®æ˜¯å‡½æ•°

m.get(hello)  // Hello ES6!
```

#### 4. has(key)

> è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨å½“å‰ Map å¯¹è±¡ä¹‹ä¸­ã€‚

```javascript
const m = new Map();

m.set('edition', 6);
m.set(262, 'standard');
m.set(undefined, 'nah');

m.has('edition')     // true
m.has('years')       // false
m.has(262)           // true
m.has(undefined)     // true
```

#### 5. delete(key)

> åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å›trueã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å›falseã€‚

```javascript
const m = new Map()
m.set(undefined, 'nah')
m.has(undefined) // true

m.delete(undefined)
m.has(undefined) // false
```

#### 6. clear()

> æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚

```javascript
let map = new Map()
map.set('foo', true)
map.set('bar', false)

map.size // 2
map.clear()
map.size // 0
```

---

### Map çš„éå†æ–¹æ³•

Map ç»“æ„åŸç”Ÿæä¾›ä¸‰ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°å’Œä¸€ä¸ªéå†æ–¹æ³•ã€‚

- `keys()`ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚
- `values()`ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚
- `entries()`ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨ã€‚
- `forEach()`ï¼šéå† Map çš„æ‰€æœ‰æˆå‘˜ã€‚

Map ç»“æ„çš„é»˜è®¤éå†å™¨æ¥å£ï¼ˆ `Symbol.iterator` å±æ€§ï¼‰ï¼Œå°±æ˜¯ `entries()` æ–¹æ³•ã€‚

```javascript
map[Symbol.iterator] === map.entries // true
```

æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ `entries()` æ–¹æ³•è¿›è¡Œéå†çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥æ–¹æ³•åï¼š

```javascript
for (let [key, value] of map.entries()) {
  console.log(key, value)
}
// ç­‰åŒäºä½¿ç”¨map.entries()
for (let [key, value] of map) {
  console.log(key, value)
}
```

Map ä¾ç„¶å¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆ `...` ï¼‰å°† Map ç»“æ„è½¬ä¸ºæ•°ç»„ç»“æ„ã€‚

æ‰€ä»¥ï¼Œå¯ä»¥ç»“åˆæ•°ç»„çš„ `map` æ–¹æ³•ã€`filter` æ–¹æ³•ï¼Œå¯ä»¥å®ç° Map çš„éå†å’Œè¿‡æ»¤ï¼ˆ Map æœ¬èº«æ²¡æœ‰ `map` å’Œ `filter` æ–¹æ³•ï¼‰ã€‚

æ­¤å¤–ï¼ŒMap è¿˜æœ‰ä¸€ä¸ª `forEach` æ–¹æ³•ï¼Œä¸æ•°ç»„çš„ `forEach` æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥å®ç°éå†ï¼š

```javascript
map.forEach(function(value, key, map) {
  console.log("Key: %s, Value: %s", key, value)
})
```

---

### WeakMap

`WeakMap` ç»“æ„ä¸ Map ç»“æ„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç”Ÿæˆé”®å€¼å¯¹çš„é›†åˆï¼š

**`WeakMap` ä¸ Map çš„åŒºåˆ«æœ‰ä¸¤ç‚¹ï¼š**

1. `WeakMap` åªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆ **null** é™¤å¤–ï¼‰ï¼Œä¸æ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºé”®åã€‚
2. `WeakMap` çš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œ`WeakMap` çš„ä¸“ç”¨åœºåˆå°±æ˜¯ï¼Œå®ƒçš„é”®æ‰€å¯¹åº”çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šåœ¨å°†æ¥æ¶ˆå¤±ã€‚`WeakMap` ç»“æ„æœ‰åŠ©äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

---

### WeakMap çš„åº”ç”¨

WeakMap åº”ç”¨çš„å…¸å‹åœºåˆå°±æ˜¯ DOM èŠ‚ç‚¹ä½œä¸ºé”®åï¼š

```javascript
let myElement = document.getElementById('logo')
let myWeakmap = new WeakMap()

myWeakmap.set(myElement, {timesClicked: 0})

myElement.addEventListener('click', function() {
  let logoData = myWeakmap.get(myElement)
  logoData.timesClicked++
}, false)
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`myElement` æ˜¯ä¸€ä¸ª DOM èŠ‚ç‚¹ï¼Œæ¯å½“å‘ç”Ÿ `click` äº‹ä»¶ï¼Œå°±æ›´æ–°ä¸€ä¸‹çŠ¶æ€ã€‚æˆ‘ä»¬å°†è¿™ä¸ªçŠ¶æ€ä½œä¸ºé”®å€¼æ”¾åœ¨ WeakMap é‡Œï¼Œå¯¹åº”çš„é”®åå°±æ˜¯ `myElement`ã€‚ä¸€æ—¦è¿™ä¸ª DOM èŠ‚ç‚¹åˆ é™¤ï¼Œè¯¥çŠ¶æ€å°±ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œä¸å­˜åœ¨å†…å­˜æ³„æ¼é£é™©ã€‚

å¦ä¸€ä¸ªç”¨å¤„æ˜¯éƒ¨ç½²ç§æœ‰å±æ€§ï¼š

```javascript
const _counter = new WeakMap()
const _action = new WeakMap()

class Countdown {
  constructor(counter, action) {
    _counter.set(this, counter)
    _action.set(this, action)
  }
  dec() {
    let counter = _counter.get(this)
    if (counter < 1) return
    counter--
    _counter.set(this, counter)
    if (counter === 0) {
      _action.get(this)()
    }
  }
}

const c = new Countdown(2, () => console.log('DONE'))

c.dec()
c.dec()
// DONE
```

`Countdown` ç±»çš„ä¸¤ä¸ªå†…éƒ¨å±æ€§ `_counter` å’Œ `_action`ï¼Œæ˜¯å®ä¾‹çš„å¼±å¼•ç”¨ï¼Œæ‰€ä»¥å¦‚æœåˆ é™¤å®ä¾‹ï¼Œå®ƒä»¬ä¹Ÿå°±éšä¹‹æ¶ˆå¤±ï¼Œä¸ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚