### Iteratorï¼ˆ éå†å™¨ ï¼‰

**æ¦‚å¿µ**

> JavaScript åŸæœ‰çš„è¡¨ç¤ºã€Œé›†åˆã€çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦æ˜¯æ•°ç»„ï¼ˆ Array ï¼‰å’Œå¯¹è±¡ï¼ˆ Object ï¼‰ï¼ŒES6 åˆæ·»åŠ äº† Map å’Œ Setã€‚è¿™æ ·å°±æœ‰äº†å››ç§æ•°æ®é›†åˆï¼Œç”¨æˆ·è¿˜å¯ä»¥ç»„åˆä½¿ç”¨å®ƒä»¬ï¼Œå®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æ•°ç»„çš„æˆå‘˜æ˜¯ Mapï¼ŒMap çš„æˆå‘˜æ˜¯å¯¹è±¡ã€‚è¿™æ ·å°±éœ€è¦ä¸€ç§ç»Ÿä¸€çš„æ¥å£æœºåˆ¶ï¼Œæ¥å¤„ç†æ‰€æœ‰ä¸åŒçš„æ•°æ®ç»“æ„ã€‚
> 
> éå†å™¨ï¼ˆ Iterator ï¼‰å°±æ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ã€‚å®ƒæ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚

Iterator çš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼š

1. ä¸€æ˜¯ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›
2. äºŒæ˜¯ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›
3. ä¸‰æ˜¯ ES6 åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤ `for...of` å¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾› `for...of` æ¶ˆè´¹ã€‚

Iterator çš„éå†è¿‡ç¨‹ï¼š

1. åˆ›å»ºä¸€ä¸ªã€ŒæŒ‡é’ˆå¯¹è±¡ã€ï¼ŒæŒ‡å‘å½“å‰æ•°æ®ç»“æ„çš„**èµ·å§‹ä½ç½®**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œéå†å™¨å¯¹è±¡æœ¬è´¨ä¸Šï¼Œå°±æ˜¯ä¸€ä¸ªã€ŒæŒ‡é’ˆå¯¹è±¡ã€ã€‚
1. ç¬¬ä¸€æ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œå¯ä»¥å°†æŒ‡é’ˆæŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚
1. ç¬¬äºŒæ¬¡è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±æŒ‡å‘æ•°æ®ç»“æ„çš„ç¬¬äºŒä¸ªæˆå‘˜ã€‚
1. ä¸æ–­è°ƒç”¨æŒ‡é’ˆå¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œç›´åˆ°å®ƒæŒ‡å‘æ•°æ®ç»“æ„çš„ç»“æŸä½ç½®ã€‚

```javascript
var it = makeIterator(['a', 'b'])

it.next() // { value: "a", done: false }
it.next() // { value: "b", done: false }
it.next() // { value: undefined, done: true }

function makeIterator(array) {
  var nextIndex = 0
  return {
    next: function() {
      return nextIndex < array.length ?
        {value: array[nextIndex++], done: false} :
        {value: undefined, done: true}
    }
  }
}
```

æ¯ä¸€æ¬¡è°ƒç”¨ `next` æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›æ•°æ®ç»“æ„çš„å½“å‰æˆå‘˜çš„ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªåŒ…å« `value` å’Œ `done` ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ã€‚å…¶ä¸­ï¼Œ`value` å±æ€§æ˜¯å½“å‰æˆå‘˜çš„å€¼ï¼Œ`done` å±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚

å¯¹äºéå†å™¨å¯¹è±¡æ¥è¯´ï¼Œ`done: false` å’Œ `value: undefined` å±æ€§éƒ½æ˜¯å¯ä»¥çœç•¥çš„ï¼Œå› æ­¤ä¸Šé¢çš„ makeIterator å‡½æ•°å¯ä»¥ç®€å†™æˆä¸‹é¢çš„å½¢å¼ï¼š

```javascript
function makeIterator(array) {
  var nextIndex = 0
  return {
    next: function() {
      return nextIndex < array.length ?
        {value: array[nextIndex++]} :
        {done: true}
    }
  }
}
```

ç”±äº Iterator åªæ˜¯æŠŠæ¥å£è§„æ ¼åŠ åˆ°æ•°æ®ç»“æ„ä¹‹ä¸Šï¼Œæ‰€ä»¥ï¼Œéå†å™¨ä¸å®ƒæ‰€éå†çš„é‚£ä¸ªæ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šæ˜¯åˆ†å¼€çš„ï¼Œå®Œå…¨å¯ä»¥å†™å‡ºæ²¡æœ‰å¯¹åº”æ•°æ®ç»“æ„çš„éå†å™¨å¯¹è±¡ï¼Œæˆ–è€…è¯´ç”¨éå†å™¨å¯¹è±¡æ¨¡æ‹Ÿå‡ºæ•°æ®ç»“æ„ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ— é™è¿è¡Œçš„éå†å™¨å¯¹è±¡çš„ä¾‹å­ï¼š

```javascript
var it = idMaker()

it.next().value // 0
it.next().value // 1
it.next().value // 2
// ...

function idMaker() {
  var index = 0

  return {
    next: function() {
      return {value: index++, done: false}
    }
  }
}
```

---

### é»˜è®¤ Iterator æ¥å£

Iterator æ¥å£çš„ç›®çš„ï¼Œå°±æ˜¯ä¸ºæ‰€æœ‰æ•°æ®ç»“æ„ï¼Œæä¾›äº†ä¸€ç§ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ï¼Œå³ `for...of` å¾ªç¯ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ã€‚å½“ä½¿ç”¨ `for...of` å¾ªç¯éå†æŸç§æ•°æ®ç»“æ„æ—¶ï¼Œè¯¥å¾ªç¯ä¼šè‡ªåŠ¨å»å¯»æ‰¾ Iterator æ¥å£ã€‚

ä¸€ç§æ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº† Iterator æ¥å£ï¼Œæˆ‘ä»¬å°±ç§°è¿™ç§æ•°æ®ç»“æ„æ˜¯ã€Œå¯éå†çš„ã€ï¼ˆ iterable ï¼‰ã€‚

ES6 è§„å®šï¼Œé»˜è®¤çš„ Iterator æ¥å£éƒ¨ç½²åœ¨æ•°æ®ç»“æ„çš„ `Symbol.iterator` å±æ€§ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªæ•°æ®ç»“æ„åªè¦å…·æœ‰ `Symbol.iterator` å±æ€§ï¼Œå°±å¯ä»¥è®¤ä¸ºæ˜¯ã€Œå¯éå†çš„ã€ï¼ˆ iterable ï¼‰ã€‚

`Symbol.iterator` å±æ€§æœ¬èº«æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯å½“å‰æ•°æ®ç»“æ„é»˜è®¤çš„éå†å™¨ç”Ÿæˆå‡½æ•°ã€‚æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªéå†å™¨ã€‚è‡³äºå±æ€§å `Symbol.iterator`ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å› Symbol å¯¹è±¡çš„ iterator å±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ã€ç±»å‹ä¸º Symbol çš„ç‰¹æ®Šå€¼ï¼Œæ‰€ä»¥è¦æ”¾åœ¨æ–¹æ‹¬å·å†…ã€‚

```javascript
const obj = {
  [Symbol.iterator] : function () {
    return {
      next: function () {
        return {
          value: 1,
          done: true
        }
      }
    }
  }
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¯¹è±¡ `obj` æ˜¯å¯éå†çš„ï¼ˆ iterable ï¼‰ï¼Œå› ä¸ºå…·æœ‰ `Symbol.iterator` å±æ€§ï¼ˆ ç›¸å½“äºå·²ç»éƒ¨ç½²äº† Iterator æ¥å£ ï¼‰ã€‚æ‰§è¡Œè¿™ä¸ªå±æ€§ï¼Œä¼šè¿”å›ä¸€ä¸ªã€Œéå†å™¨å¯¹è±¡ã€ã€‚

ã€Œéå†å™¨å¯¹è±¡ã€çš„**æ ¹æœ¬ç‰¹å¾**æ˜¯ï¼šå…·æœ‰ `next` æ–¹æ³•ã€‚æ¯æ¬¡è°ƒç”¨ `next` æ–¹æ³•ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æˆå‘˜çš„**ä¿¡æ¯**çš„å¯¹è±¡ï¼Œå…·æœ‰ `value` å’Œ `done` ä¸¤ä¸ªå±æ€§ã€‚

ES6 çš„æœ‰äº›æ•°æ®ç»“æ„åŸç”Ÿå…·å¤‡ Iterator æ¥å£ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰ï¼Œå³ä¸ç”¨ä»»ä½•å¤„ç†ï¼Œå°±å¯ä»¥è¢« `for...of` å¾ªç¯éå†ã€‚å› ä¸ºè¿™äº›æ•°æ®ç»“æ„åŸç”Ÿéƒ¨ç½²äº† `Symbol.iterator` å±æ€§ï¼ˆ è¯¦è§ä¸‹æ–‡ ï¼‰ï¼Œå¦å¤–ä¸€äº›æ•°æ®ç»“æ„æ²¡æœ‰ï¼ˆ æ¯”å¦‚å¯¹è±¡ ï¼‰ã€‚å‡¡æ˜¯éƒ¨ç½²äº† `Symbol.iterator` å±æ€§çš„æ•°æ®ç»“æ„ï¼Œå°±ç§°ä¸º**éƒ¨ç½²äº†éå†å™¨æ¥å£**ã€‚è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª**éå†å™¨å¯¹è±¡**ã€‚

---

JavaScript åŸç”Ÿå°±å…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„æœ‰ï¼š

- Array
- Map
- Set
- String
- TypedArray
- å‡½æ•°çš„ arguments å¯¹è±¡
- NodeList å¯¹è±¡

ä¸‹é¢çš„ä¾‹å­æ˜¯æ•°ç»„çš„ `Symbol.iterator` å±æ€§ï¼š

```javascript
let arr = ['a', 'b', 'c']
let iter = arr[Symbol.iterator]()

iter.next() // { value: 'a', done: false }
iter.next() // { value: 'b', done: false }
iter.next() // { value: 'c', done: false }
iter.next() // { value: undefined, done: true }
```

å¯¹è±¡ï¼ˆ Object ï¼‰ä¹‹æ‰€ä»¥æ²¡æœ‰é»˜è®¤éƒ¨ç½² Iterator æ¥å£ï¼Œæ˜¯å› ä¸ºå¯¹è±¡çš„å“ªä¸ªå±æ€§å…ˆéå†ï¼Œå“ªä¸ªå±æ€§åéå†æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨æŒ‡å®šã€‚æœ¬è´¨ä¸Šï¼Œéå†å™¨æ˜¯ä¸€ç§**çº¿æ€§å¤„ç†**ï¼Œå¯¹äºä»»ä½•éçº¿æ€§çš„æ•°æ®ç»“æ„ï¼Œéƒ¨ç½²éå†å™¨æ¥å£ï¼Œå°±ç­‰äºéƒ¨ç½²ä¸€ç§çº¿æ€§è½¬æ¢ã€‚ä¸è¿‡ï¼Œä¸¥æ ¼åœ°è¯´ï¼Œå¯¹è±¡éƒ¨ç½²éå†å™¨æ¥å£å¹¶ä¸æ˜¯å¾ˆå¿…è¦ï¼Œå› ä¸ºè¿™æ—¶å¯¹è±¡å®é™…ä¸Šè¢«å½“ä½œ Map ç»“æ„ä½¿ç”¨ï¼ŒES5 æ²¡æœ‰ Map ç»“æ„ï¼Œè€Œ ES6 åŸç”Ÿæä¾›äº†ã€‚

ä¸€ä¸ªå¯¹è±¡å¦‚æœè¦å…·å¤‡å¯è¢« `for...of` å¾ªç¯è°ƒç”¨çš„ Iterator æ¥å£ï¼Œå°±å¿…é¡»åœ¨ `Symbol.iterator` çš„å±æ€§ä¸Šéƒ¨ç½²éå†å™¨ç”Ÿæˆæ–¹æ³•ï¼ˆ åŸå‹é“¾ä¸Šçš„å¯¹è±¡å…·æœ‰è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥ ï¼‰ã€‚

```javascript
class RangeIterator {
  constructor(start, stop) {
    this.value = start
    this.stop = stop
  }

  [Symbol.iterator]() { return this }

  next() {
    var value = this.value
    if (value < this.stop) {
      this.value++
      return {done: false, value: value}
    }
    return {done: true, value: undefined}
  }
}

function range(start, stop) {
  return new RangeIterator(start, stop)
}

for (var value of range(0, 3)) {
  console.log(value) // 0, 1, 2
}
```

ä¸‹é¢æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­ ğŸŒ° ï¼Œä¸ºå¯¹è±¡æ·»åŠ  Iterator æ¥å£ï¼š

```javascript
let obj = {
  data: [ 'hello', 'world' ],
  [Symbol.iterator]() {
    const self = this
    let index = 0
    return {
      next() {
        if (index < self.data.length) {
          return {
            value: self.data[index++],
            done: false
          }
        } else {
          return { value: undefined, done: true }
        }
      }
    }
  }
}
```

å¯¹äºã€Œç±»æ•°ç»„å¯¹è±¡ã€ï¼ˆ å­˜åœ¨æ•°å€¼é”®åå’Œ `length` å±æ€§ ï¼‰ï¼Œéƒ¨ç½² Iterator æ¥å£ï¼Œæœ‰ä¸€ä¸ªç®€ä¾¿æ–¹æ³•ï¼Œå°±æ˜¯ `Symbol.iterator` æ–¹æ³•ç›´æ¥å¼•ç”¨æ•°ç»„çš„ Iterator æ¥å£ï¼š

```javascript
NodeList.prototype[Symbol.iterator] = Array.prototype[Symbol.iterator]
// æˆ–è€…
NodeList.prototype[Symbol.iterator] = [][Symbol.iterator]

[...document.querySelectorAll('div')] // å¯ä»¥æ‰§è¡Œäº†
```

---

### è°ƒç”¨ Iterator æ¥å£çš„åœºåˆ

æ¥ä¸‹æ¥ä¸¾ä¾‹å‡ ä¸ªä¼šé»˜è®¤è°ƒç”¨ Iterator æ¥å£çš„åœºåˆï¼š

#### 1. è§£æ„èµ‹å€¼

> å¯¹æ•°ç»„å’Œ Set ç»“æ„è¿›è¡Œè§£æ„èµ‹å€¼æ—¶ï¼Œä¼šé»˜è®¤è°ƒç”¨ `Symbol.iterator` æ–¹æ³•ã€‚

```javascript
let set = new Set().add('a').add('b').add('c')

let [x,y] = set
// x='a' y='b'

let [first, ...rest] = set
// first='a' rest=['b','c']
```

#### 2. æ‰©å±•è¿ç®—ç¬¦

> æ‰©å±•è¿ç®—ç¬¦ï¼ˆ `...` ï¼‰ä¹Ÿä¼šè°ƒç”¨é»˜è®¤çš„ Iterator æ¥å£ã€‚

```javascript
// ä¾‹ä¸€
var str = 'hello'
[...str] //  ['h','e','l','l','o']

// ä¾‹äºŒ
let arr = ['b', 'c']
['a', ...arr, 'd']
// ['a', 'b', 'c', 'd']
```

å®é™…ä¸Šï¼Œè¿™æä¾›äº†ä¸€ç§ç®€ä¾¿æœºåˆ¶ï¼Œå¯ä»¥å°†ä»»ä½•éƒ¨ç½²äº† Iterator æ¥å£çš„æ•°æ®ç»“æ„ï¼Œè½¬ä¸ºæ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æŸä¸ªæ•°æ®ç»“æ„éƒ¨ç½²äº† Iterator æ¥å£ï¼Œå°±å¯ä»¥å¯¹å®ƒä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†å…¶è½¬ä¸ºæ•°ç»„ï¼š

```javascript
let arr = [...iterable]
```

æ‰€ä»¥ä¸Šé¢çš„å­—ç¬¦ä¸²ä¹‹æ‰€ä»¥èƒ½å¤Ÿè¢«ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼ˆ `...` ï¼‰è½¬æ¢æˆæ•°ç»„ï¼Œä¹Ÿæ˜¯å› ä¸º `String.prototype` ä¸Šéƒ¨ç½²äº† Iterator æ¥å£ã€‚

#### 3. yield*

`yield*` åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªå¯éå†çš„ç»“æ„ï¼ˆ è¯¦è§ Generator ï¼‰ï¼Œå®ƒä¼šè°ƒç”¨è¯¥ç»“æ„çš„éå†å™¨æ¥å£ï¼š

```javascript
let generator = function* () {
  yield 1
  yield* [2,3,4]
  yield 5
}

var iterator = generator()

iterator.next() // { value: 1, done: false }
iterator.next() // { value: 2, done: false }
iterator.next() // { value: 3, done: false }
iterator.next() // { value: 4, done: false }
iterator.next() // { value: 5, done: false }
iterator.next() // { value: undefined, done: true }
```

#### 4. å…¶ä»–åœºåˆ

ç”±äºæ•°ç»„çš„éå†ä¼šè°ƒç”¨éå†å™¨æ¥å£ï¼Œæ‰€ä»¥ä»»ä½•æ¥å—æ•°ç»„**ä½œä¸ºå‚æ•°**çš„åœºåˆï¼Œå…¶å®éƒ½è°ƒç”¨äº†ã€Œéå†å™¨æ¥å£ã€ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š

- for...of
- Array.from()
- Map(), Set(), WeakMap(), WeakSet()ï¼ˆæ¯”å¦‚new Map([['a',1],['b',2]])ï¼‰
- Promise.all()
- Promise.race()

---

### å­—ç¬¦ä¸²çš„ Iterator æ¥å£

å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªã€Œç±»æ•°ç»„å¯¹è±¡ã€ï¼Œä¹ŸåŸç”Ÿå…·æœ‰ Iterator æ¥å£ï¼š

```javascript
var someString = "hi"
typeof someString[Symbol.iterator]
// "function"

var iterator = someString[Symbol.iterator]()

iterator.next()  // { value: "h", done: false }
iterator.next()  // { value: "i", done: false }
iterator.next()  // { value: undefined, done: true }
```

---

### for...of å¾ªç¯

ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº† `Symbol.iterator` å±æ€§ï¼Œå°±è¢«è§†ä¸ºå…·æœ‰ iterator æ¥å£ï¼Œå°±å¯ä»¥ç”¨ `for...of` å¾ªç¯éå†å®ƒçš„æˆå‘˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`for...of` å¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„ `Symbol.iterator` æ–¹æ³•ã€‚

`for...of` å¾ªç¯å¯ä»¥ä½¿ç”¨çš„èŒƒå›´åŒ…æ‹¬**æ•°ç»„**ã€**Set** å’Œ **Map** ç»“æ„ã€æŸäº›ç±»æ•°ç»„å¯¹è±¡ï¼ˆ æ¯”å¦‚ arguments å¯¹è±¡ã€DOM NodeList å¯¹è±¡ ï¼‰ã€Generator å¯¹è±¡ï¼Œä»¥åŠå­—ç¬¦ä¸²ã€‚

#### æ•°ç»„

éœ€è¦æ³¨æ„çš„ä¸€ä¸ªæ˜¯ï¼š

`for...of` å¾ªç¯è°ƒç”¨éå†å™¨æ¥å£ï¼Œæ•°ç»„çš„éå†å™¨æ¥å£åªè¿”å›**å…·æœ‰æ•°å­—ç´¢å¼•**çš„å±æ€§ã€‚è¿™ä¸€ç‚¹è·Ÿ `for...in` å¾ªç¯ä¹Ÿä¸ä¸€æ ·ï¼š

```javascript
let arr = [3, 5, 7]
arr.foo = 'hello'

for (let i in arr) {
  console.log(i) // "0", "1", "2", "foo"
}

for (let i of arr) {
  console.log(i) //  "3", "5", "7"
}
```

---

### Set å’Œ Map ç»“æ„

Set å’Œ Map ç»“æ„ä¹ŸåŸç”Ÿå…·æœ‰ Iterator æ¥å£ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `for...of` å¾ªç¯ã€‚

```javascript
let map = new Map().set('a', 1).set('b', 2)
for (let pair of map) {
  console.log(pair)
}
// ['a', 1]
// ['b', 2]

for (let [key, value] of map) {
  console.log(key + ' : ' + value)
}
// a : 1
// b : 2
```

---

### ä¸å…¶ä»–éå†è¯­æ³•çš„æ¯”è¾ƒ

ä»¥æ•°ç»„ä¸ºä¾‹ï¼ŒJavaScript æä¾›å¤šç§éå†è¯­æ³•ã€‚æœ€åŸå§‹çš„å†™æ³•å°±æ˜¯ `for` å¾ªç¯ï¼š

```javascript
for (var index = 0; index < myArray.length; index++) {
  console.log(myArray[index])
}
```

è¿™ç§å†™æ³•æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤æ•°ç»„æä¾›å†…ç½®çš„ `forEach` æ–¹æ³•ï¼š

```javascript
myArray.forEach(function (value) {
  console.log(value)
})
```

ç„¶é¹…ï¼Œè¿™ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œæ— æ³•ä¸­é€”è·³å‡º `forEach` å¾ªç¯ï¼Œ`break` å‘½ä»¤æˆ– `return` å‘½ä»¤éƒ½ä¸èƒ½å¥æ•ˆã€‚

`for...in` å¾ªç¯å¯ä»¥éå†æ•°ç»„çš„é”®åï¼š

```javascript
for (var index in myArray) {
  console.log(myArray[index])
}
```

ä½†æ˜¯ï¼Œ`for...in` å¾ªç¯æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š

- æ•°ç»„çš„é”®åè™½ç„¶éƒ½æ˜¯æ•°å­—ï¼Œä½†æ˜¯ `for...in` å¾ªç¯æ˜¯ä»¥**å­—ç¬¦ä¸²**ä½œä¸ºé”®å `"1"`ã€`"2"`ã€`"3"` ç­‰ç­‰ã€‚
- `for...in` å¾ªç¯ä¸ä»…éå†æ•°å­—é”®åï¼Œè¿˜ä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ã€‚
- æŸäº›æƒ…å†µä¸‹ï¼Œ`for...in` å¾ªç¯ä¼šä»¥**ä»»æ„é¡ºåº**éå†é”®åã€‚

æ€»ä¹‹ï¼Œ`for...in` å¾ªç¯ä¸»è¦æ˜¯ä¸ºéå†å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œ**ä¸é€‚ç”¨äºéå†æ•°ç»„**ã€‚

`for...of` å¾ªç¯ç›¸æ¯”ä¸Šé¢å‡ ç§åšæ³•ï¼Œæœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ï¼š

- æœ‰ç€åŒ `for...in` ä¸€æ ·çš„ç®€æ´è¯­æ³•ï¼Œä½†æ˜¯æ²¡æœ‰ `for...in` é‚£äº›ç¼ºç‚¹ã€‚
- ä¸åŒäº `forEach` æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸ `break`ã€`continue` å’Œ `return` é…åˆä½¿ç”¨ã€‚
- æä¾›äº†éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ“ä½œæ¥å£ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ break è¯­å¥ï¼Œè·³å‡ºfor...ofå¾ªç¯çš„ä¾‹å­ã€‚

```javascript
for (var n of fibonacci) {
  if (n > 1000)
    break;
  console.log(n)
}
```

ä¸Šé¢çš„ä¾‹å­ï¼Œä¼šè¾“å‡ºæ–æ³¢çº³å¥‘æ•°åˆ—å°äºç­‰äº 1000 çš„é¡¹ã€‚å¦‚æœå½“å‰é¡¹å¤§äº 1000ï¼Œå°±ä¼šä½¿ç”¨breakè¯­å¥è·³å‡ºfor...ofå¾ªç¯ã€‚