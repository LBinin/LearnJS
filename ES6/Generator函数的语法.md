### åŸºæœ¬æ¦‚å¿µ

**Generator** å‡½æ•°æ˜¯ ES6 æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆï¼Œè¯­æ³•è¡Œä¸ºä¸ä¼ ç»Ÿå‡½æ•°å®Œå…¨ä¸åŒã€‚è¿™é‡Œä»‹ç»çš„äº‹ Generator å‡½æ•°çš„è¯­æ³•å’Œ APIï¼Œå®ƒçš„å¼‚æ­¥ç¼–ç¨‹åº”ç”¨è®°å½•åœ¨ã€ŒGenerator å‡½æ•°çš„å¼‚æ­¥åº”ç”¨ã€ã€‚

Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚

è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼Œ**Generator** å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡Œ **Generator** å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**Generator** å‡½æ•°é™¤äº†çŠ¶æ€æœºï¼Œè¿˜æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ç”Ÿæˆå‡½æ•°ã€‚è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œå¯ä»¥ä¾æ¬¡éå† **Generator** å‡½æ•°å†…éƒ¨çš„æ¯ä¸€ä¸ªçŠ¶æ€ã€‚

å½¢å¼ä¸Šï¼Œ**Generator** å‡½æ•°è™½ç„¶æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ã€‚ä¸€æ˜¯ï¼Œ`function` å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›äºŒæ˜¯ï¼Œå‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨ `yield` è¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ï¼ˆ **yield** åœ¨è‹±è¯­é‡Œçš„æ„æ€å°±æ˜¯ã€Œäº§å‡ºã€ï¼‰ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­ ğŸŒ°

```javascript
function* helloWorldGenerator() {
  yield 'hello'
  yield 'world'
  return 'ending'
}

var hw = helloWorldGenerator()
```

ä¸Šé¢ä»£ç å®šä¹‰äº†ä¸€ä¸ª **Generator** å‡½æ•° `helloWorldGenerator`ï¼Œå®ƒå†…éƒ¨æœ‰ä¸¤ä¸ª `yield` è¡¨è¾¾å¼ï¼ˆ `hello` å’Œ `world` ï¼‰ï¼Œå³è¯¥å‡½æ•°æœ‰**ä¸‰ä¸ªçŠ¶æ€**ï¼š`hello`ï¼Œ`world` å’Œ `return` è¯­å¥ï¼ˆ ç»“æŸæ‰§è¡Œ ï¼‰ã€‚

ç„¶åï¼Œ**Generator** å‡½æ•°çš„è°ƒç”¨æ–¹æ³•ä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œä¹Ÿæ˜¯åœ¨å‡½æ•°ååé¢åŠ ä¸Šä¸€å¯¹åœ†æ‹¬å·ã€‚ä¸åŒçš„æ˜¯ï¼Œè°ƒç”¨ **Generator** å‡½æ•°åï¼Œè¯¥å‡½æ•°**å¹¶ä¸æ‰§è¡Œ**ï¼Œè¿”å›çš„ä¹Ÿä¸æ˜¯**å‡½æ•°è¿è¡Œç»“æœ**ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å‡½æ•°**å†…éƒ¨çŠ¶æ€**çš„ã€ŒæŒ‡é’ˆå¯¹è±¡ã€ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰ä»‹ç»çš„ã€Œéå†å™¨å¯¹è±¡ã€ã€‚

ä¸‹ä¸€æ­¥ï¼Œå¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„ `next` æ–¹æ³•ï¼Œä½¿å¾—æŒ‡é’ˆç§»å‘**ä¸‹ä¸€ä¸ªçŠ¶æ€**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡è°ƒç”¨ `next` æ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª `yield` è¡¨è¾¾å¼ï¼ˆ æˆ– `return` è¯­å¥ ï¼‰ä¸ºæ­¢ã€‚æ¢è¨€ä¹‹ï¼Œ**Generator** å‡½æ•°æ˜¯åˆ†æ®µæ‰§è¡Œçš„ï¼Œ`yield` è¡¨è¾¾å¼æ˜¯æš‚åœæ‰§è¡Œçš„æ ‡è®°ï¼Œè€Œ `next` æ–¹æ³•å¯ä»¥æ¢å¤æ‰§è¡Œã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ‰§è¡Œçœ‹çœ‹ï¼š

```javascript
hw.next()
// { value: 'hello', done: false }

hw.next()
// { value: 'world', done: false }

hw.next()
// { value: 'ending', done: true }

hw.next()
// { value: undefined, done: true }
```

---

### æ ¼å¼

ES6 æ²¡æœ‰è§„å®šï¼Œ`function` å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´çš„æ˜Ÿå·ï¼Œå†™åœ¨å“ªä¸ªä½ç½®ã€‚æ‰€ä»¥å¯¼è‡´ä¸‹é¢çš„å†™æ³•éƒ½èƒ½é€šè¿‡ï¼š

```javascript
function * foo(x, y) { Â·Â·Â· }
function *foo(x, y) { Â·Â·Â· }
function* foo(x, y) { Â·Â·Â· }
function*foo(x, y) { Â·Â·Â· }
```

---

### yield è¡¨è¾¾å¼

ç”±äº Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨nextæ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ã€‚

æ‰€ä»¥ Generator å…¶å®æä¾›äº†ä¸€ç§å¯ä»¥ã€Œæš‚åœæ‰§è¡Œã€çš„å‡½æ•°ã€‚`yield` è¡¨è¾¾å¼å°±æ˜¯ã€Œæš‚åœæ ‡å¿—ã€ã€‚

åœ¨è°ƒç”¨äº† `next` æ–¹æ³•åï¼Œæ“ä½œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š

1. é‡åˆ° `yield` è¡¨è¾¾å¼ï¼Œå°±**æš‚åœæ‰§è¡Œåç»­çš„æ“ä½œ**ï¼Œå¹¶å°†ç´§è·Ÿåœ¨ `yield` åé¢çš„é‚£ä¸ª**è¡¨è¾¾å¼**çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„ä¿¡æ¯å¯¹è±¡çš„ `value` å±æ€§å€¼ã€‚
1. ä¸‹ä¸€æ¬¡è°ƒç”¨éå†å™¨çš„ `next` æ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª `yield` è¡¨è¾¾å¼ã€‚
1. å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„ `yield` è¡¨è¾¾å¼ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ° `return` è¯­å¥ä¸ºæ­¢ï¼Œå¹¶å°† `return` è¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„ `value` å±æ€§å€¼ï¼ŒåŒæ—¶ `done` å±æ€§è¾“å‡ºä¸º `true`ã€‚
1. å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰ `return` è¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„ `value` å±æ€§å€¼ä¸º `undefined`ï¼ŒåŒæ—¶ `done` å±æ€§è¾“å‡ºä¸º `true`ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ä¸ªæ˜¯ï¼š`yield` è¡¨è¾¾å¼åé¢çš„è¡¨è¾¾å¼ï¼Œåªæœ‰å½“è°ƒç”¨ `next` æ–¹æ³•ã€å†…éƒ¨æŒ‡é’ˆ**æŒ‡å‘è¯¥è¯­å¥**æ—¶æ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤ç­‰äºä¸º JavaScript æä¾›äº†æ‰‹åŠ¨çš„ã€Œæƒ°æ€§æ±‚å€¼ã€ï¼ˆ Lazy Evaluation ï¼‰çš„è¯­æ³•åŠŸèƒ½ã€‚

å¦å¤–ï¼Œ`yield` è¡¨è¾¾å¼å¦‚æœç”¨åœ¨å¦ä¸€ä¸ªè¡¨è¾¾å¼ä¹‹ä¸­ï¼Œå¿…é¡»æ”¾åœ¨**åœ†æ‹¬å·**é‡Œé¢ã€‚

```javascript
function* demo() {
  console.log('Hello' + yield) // SyntaxError
  console.log('Hello' + yield 123) // SyntaxError

  console.log('Hello' + (yield)) // OK
  console.log('Hello' + (yield 123)) // OK
}
```

---

### ä¸ Iterator æ¥å£çš„å…³ç³»

å› ä¸ºä¸Šé¢ç”¨åˆ°äº† `next` æ–¹æ³•ï¼Œæœ‰æ²¡æœ‰è§‰å¾—å’Œä¹‹å‰è¯´çš„ **Iterator** æœ‰å‡ åˆ†ç›¸ä¼¼ï¼Ÿ

æ¥ä¸‹æ¥å’±ä»¬å°±è¯´è¯´å®ƒä»¬ä¹‹é—´çš„å…³ç³»~

ä¹‹å‰è¯´è¿‡ï¼Œä»»æ„ä¸€ä¸ªå¯¹è±¡çš„ `Symbol.iterator` æ–¹æ³•ï¼Œç­‰äºè¯¥å¯¹è±¡çš„**éå†å™¨ç”Ÿæˆå‡½æ•°**ï¼Œè°ƒç”¨è¯¥å‡½æ•°ä¼šè¿”å›è¯¥å¯¹è±¡çš„ä¸€ä¸ªã€Œéå†å™¨å¯¹è±¡ã€ã€‚

ç”±äº Generator å‡½æ•°å°±æ˜¯**éå†å™¨ç”Ÿæˆå‡½æ•°**ï¼Œå› æ­¤å¯ä»¥æŠŠ Generator èµ‹å€¼ç»™å¯¹è±¡çš„ `Symbol.iterator` å±æ€§ï¼Œä»è€Œä½¿å¾—è¯¥å¯¹è±¡å…·æœ‰ Iterator æ¥å£ã€‚

æ‰€ä»¥è¯´ï¼Œ`Symbol.iterator` æ–¹æ³•çš„æœ€ç®€å•å®ç°ï¼Œè¿˜æ˜¯ä½¿ç”¨ Generator å‡½æ•°ï¼š

```javascript
let myIterable = {
  [Symbol.iterator]: function* () {
    yield 1
    yield 2
    yield 3
  }
}
[...myIterable] // [1, 2, 3]

// æˆ–è€…é‡‡ç”¨ä¸‹é¢çš„ç®€æ´å†™æ³•

let obj = {
  * [Symbol.iterator]() {
    yield 'hello'
    yield 'world'
  }
}

for (let x of obj) {
  console.log(x)
}
// "hello"
// "world"
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`Symbol.iterator` æ–¹æ³•å‡ ä¹ä¸ç”¨éƒ¨ç½²ä»»ä½•ä»£ç ï¼Œåªè¦ç”¨ `yield` å‘½ä»¤ç»™å‡ºæ¯ä¸€æ­¥çš„è¿”å›å€¼å³å¯ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹å°±æ˜¯ï¼šGenerator å‡½æ•°æ‰§è¡Œåï¼Œè¿”å›ä¸€ä¸ªã€Œéå†å™¨å¯¹è±¡ã€ã€‚è¯¥å¯¹è±¡æœ¬èº«ä¹Ÿå…·æœ‰ `Symbol.iterator` å±æ€§ï¼Œæ‰§è¡Œåè¿”å›**è‡ªèº«**ã€‚

---

### next æ–¹æ³•çš„å‚æ•°

åœ¨ `next` æ–¹æ³•ä¸­æ·»åŠ å‚æ•°è¿™ä¸ªåŠŸèƒ½æœ‰å¾ˆé‡è¦çš„è¯­æ³•æ„ä¹‰ã€‚

Generator å‡½æ•°ä»æš‚åœçŠ¶æ€åˆ°æ¢å¤è¿è¡Œï¼Œå®ƒçš„ä¸Šä¸‹æ–‡çŠ¶æ€ï¼ˆ context ï¼‰æ˜¯ä¸å˜çš„ã€‚

ä½†æ˜¯é€šè¿‡ `next` æ–¹æ³•çš„å‚æ•°ï¼Œå°±æœ‰åŠæ³•åœ¨ Generator å‡½æ•°å¼€å§‹è¿è¡Œä¹‹åï¼Œç»§ç»­å‘å‡½æ•°ä½“å†…éƒ¨**æ³¨å…¥å€¼**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥åœ¨ Generator å‡½æ•°è¿è¡Œçš„ä¸åŒé˜¶æ®µï¼Œä»å¤–éƒ¨å‘å†…éƒ¨æ³¨å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œ**è°ƒæ•´å‡½æ•°è¡Œä¸º**ã€‚

å…ˆæ¥è¯´è¯´ `yield` è¡¨è¾¾å¼ï¼Œå®ƒæœ¬èº«æ²¡æœ‰**è¿”å›å€¼**çš„ï¼Œæˆ–è€…è¯´æ€»æ˜¯è¿”å› `undefined`ã€‚`next` æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œå½“å‰ `yield` è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚

æ³¨æ„ï¼Œåœ¨é˜®è€å¸ˆçš„æ–‡ç« ä¸­ï¼Œè¿™é‡Œè¯´çš„æ˜¯ã€Œ`next` æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å°±ä¼šè¢«å½“ä½œä¸Šä¸€ä¸ª `yield` è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚ã€ç„¶é¹…æˆ‘æ¢äº†ä¸€ç§æ–¹å¼æ–¹ä¾¿ç†è§£ï¼š

å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€ä¸ªå°ä¾‹å­ï¼š

```javascript
function* f() {
  for(var i = 0; true; i++) {
    var reset = yield i
    if(reset) { i = -1 }
  }
}

var g = f()

g.next() // { value: 0, done: false }
g.next() // { value: 1, done: false }
g.next(true) // { value: 0, done: false }
```

ç¬¬ä¸€ä¸ª `next`ï¼Œè¿è¡Œåˆ° `yield` çš„æ—¶å€™ï¼Œè¿™æ—¶ç¨‹åºæš‚åœï¼Œè¿”å›çš„ã€Œä¿¡æ¯å¯¹è±¡ã€ä¸­çš„ `value` è¿”å›ç¬¬ä¸€ä¸ª `i`ï¼Œä¹Ÿå°±æ˜¯ **0**ï¼Œ**è®°ä½**ï¼Œè¿™æ—¶å€™æ˜¯æš‚åœåœ¨ `yield` è¿™é‡Œï¼Œä½†æ˜¯å½“å‰è¿™æ¡è¯­å¥å¹¶æ²¡æœ‰ç»“æŸï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™çš„ `yield` å¹¶æ²¡æœ‰å¼€å§‹è¿”å› `undefined`ã€‚

ç¬¬äºŒä¸ª `next` çš„å†…å®¹å’Œç¬¬ä¸€ä¸ªä¸€æ ·ï¼Œä¸»è¦æˆ‘ä»¬è¦è®²ä¸‹ä¸€ä¸ªã€‚

ç¬¬ä¸‰ä¸ª `next` æœ‰å‚æ•°ï¼Œæ³¨æ„è¿™æ—¶å€™ç¬¬äºŒæ¬¡å¾ªç¯çš„ `var reset = yield i` è¿˜æ²¡æœ‰ç»“æŸï¼Œåªæ˜¯è¿”å›äº† `value: 1`ï¼›æ­¤æ—¶ `yield` è¿˜æ²¡æœ‰è¿”å› `undefined`ã€‚

è¿™æ—¶å€™ä¼ é€’ä¸€ä¸ª `true` ç»™ `next` æ–¹æ³•ï¼Œè¿™ä¸ªå‚æ•°å°±ä¼šè¢«å½“åš `yield` çš„è¿”å›ï¼›ä¹Ÿå°±æ˜¯è¯´è¿™æ—¶å€™æ‰§è¡Œ `next` çš„è¯ï¼Œ`yield` çš„è¿”å›å€¼ä¸º `true` ç»™ `reset`ã€‚

ä¹‹åç¨‹åºä»ã€Œæš‚åœã€çŠ¶æ€å¼€å§‹ç»§ç»­æ‰§è¡Œï¼Œè¿è¡Œåˆ° `if` è¯­å¥ä½¿å¾— `i = -1`ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶åœç•™åœ¨ç¬¬äºŒæ¬¡å¾ªç¯ï¼Œå¾ªç¯å°¾éƒ¨ `i++` åï¼Œ`i` ä¾¿ç­‰äº **0** äº†ï¼Œæ‰€ä»¥ç¬¬ä¸‰æ¬¡è¿”å›çš„ä¿¡æ¯å¯¹è±¡ä¸­çš„ `value` ä¾¿æ˜¯ **0**ã€‚

å†æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

```javascript
function* foo(x) {
  var y = 2 * (yield (x + 1))
  var z = yield (y / 3)
  return (x + y + z)
}

var a = foo(5)
a.next() // Object{value:6, done:false}
a.next() // Object{value:NaN, done:false}
a.next() // Object{value:NaN, done:true}

var b = foo(5)
b.next() // { value:6, done:false }
b.next(12) // { value:8, done:false }
b.next(13) // { value:42, done:true }
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç¬¬äºŒæ¬¡è¿è¡Œ `next` æ–¹æ³•çš„æ—¶å€™ä¸å¸¦å‚æ•°ï¼Œå¯¼è‡´ `y` çš„å€¼ç­‰äº `2 * undefined`ï¼ˆ å³ `NaN` ï¼‰ï¼Œé™¤ä»¥ **3** ä»¥åè¿˜æ˜¯ `NaN`ï¼Œå› æ­¤è¿”å›å¯¹è±¡çš„ `value` å±æ€§ä¹Ÿç­‰äº `NaN`ã€‚

ç¬¬ä¸‰æ¬¡è¿è¡Œ `Next` æ–¹æ³•çš„æ—¶å€™ä¸å¸¦å‚æ•°ï¼Œæ‰€ä»¥ `z` ç­‰äº `undefined`ï¼Œè¿”å›å¯¹è±¡çš„ `value` å±æ€§ç­‰äº `5 + NaN + undefined`ï¼Œå³ `NaN`ã€‚

ä¸‹é¢çš„ä¸‰ä¸ªå°±å¥½ç†è§£äº†ï¼Œæˆ‘å°±ä¸èµ˜è¿°äº†ã€‚

å…³äº `next` çš„å‚æ•°æœ‰ä¸€ä¸ªéœ€è¦è¯´çš„æ˜¯ï¼šä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰ä¸€èˆ¬ç¬¬ä¸€ä¸ª `next` æ–¹æ³•éƒ½æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰æ²¡æœ‰æ‰§è¡Œåˆ° `yield` è¯­è¨€ï¼Œè¿™æ—¶å€™ `next` æ–¹æ³•ä¸çŸ¥é“è¦æŠŠå‚æ•°èµ‹ç»™é‚£ä¸ª `yield` ä½œä¸ºè¿”å›å€¼ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ª `next` æ–¹æ³•å¸¦ä¸å¸¦å‚æ•°æ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„ã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œ**V8** å¼•æ“ç”šè‡³ç›´æ¥å¿½ç•¥ç¬¬ä¸€æ¬¡ä½¿ç”¨ `next` æ–¹æ³•æ—¶çš„å‚æ•°ï¼Œåªæœ‰ä»ç¬¬äºŒæ¬¡ä½¿ç”¨ `next` æ–¹æ³•å¼€å§‹ï¼Œå‚æ•°æ‰æ˜¯æœ‰æ•ˆçš„ã€‚

ä»è¯­ä¹‰ä¸Šè®²ï¼Œç¬¬ä¸€ä¸ª `next` æ–¹æ³•ç”¨æ¥å¯åŠ¨**éå†å™¨å¯¹è±¡**ï¼Œæ‰€ä»¥ä¸ç”¨å¸¦æœ‰å‚æ•°ã€‚

---

### ä¸ for...of

åœ¨ä¹‹å‰è¯´è¿‡ï¼š`for...of` å¾ªç¯å¯ä»¥è‡ªåŠ¨éå† Generator å‡½æ•°æ—¶ç”Ÿæˆçš„ Iterator å¯¹è±¡ï¼Œä¸”æ­¤æ—¶ä¸å†éœ€è¦è°ƒç”¨ `next` æ–¹æ³•ï¼Œä¸¾ä¸ªä¾‹å­ï¼š

```javascript
function* foo() {
  yield 1
  yield 2
  yield 3
  yield 4
  yield 5
  return 6
}

for (let v of foo()) {
  console.log(v)
}
// 1 2 3 4 5
```

å¯ä»¥çœ‹åˆ° `for...of` å¾ªç¯ä¸­å¹¶æ²¡æœ‰æ‰“å°å‡º **6**ï¼Œè¿™æ˜¯å› ä¸ºï¼šä¸€æ—¦ `next` æ–¹æ³•çš„è¿”å›å¯¹è±¡çš„ `done` å±æ€§ä¸º `true`ï¼Œ`for...of` å¾ªç¯å°±ä¼šä¸­æ­¢ï¼Œä¸”ä¸åŒ…å«è¯¥è¿”å›å¯¹è±¡ï¼Œæ‰€ä»¥ä¸Šé¢ä»£ç çš„ `return` è¯­å¥è¿”å›çš„ **6**ï¼Œä¸åŒ…æ‹¬åœ¨ `for...of` å¾ªç¯ä¹‹ä¸­ã€‚

---

### Generator.prototype.throw()

> Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ª `throw` æ–¹æ³•ï¼Œå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨ Generator å‡½æ•°ä½“å†…æ•è·ã€‚

`throw` æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢« `catch` è¯­å¥æ¥æ”¶ï¼Œå»ºè®®æŠ›å‡º **Error** å¯¹è±¡çš„å®ä¾‹ã€‚

```javascript
var g = function* () {
  try {
    yield
  } catch (e) {
    console.log(e)
  }
}

var i = g()
i.next()
i.throw(new Error('å‡ºé”™äº†ï¼'))
// Error: å‡ºé”™äº†ï¼(â€¦)
```

æ³¨æ„ï¼Œä¸è¦æ··æ·†éå†å™¨å¯¹è±¡çš„ `throw` æ–¹æ³•å’Œå…¨å±€çš„ `throw` å‘½ä»¤ã€‚ä¸Šé¢ä»£ç çš„é”™è¯¯ï¼Œæ˜¯ç”¨éå†å™¨å¯¹è±¡çš„ `throw` æ–¹æ³•æŠ›å‡ºçš„ï¼Œè€Œä¸æ˜¯ç”¨ `throw` å‘½ä»¤æŠ›å‡ºçš„ã€‚åè€…åªèƒ½è¢«å‡½æ•°ä½“å¤–çš„ `catch` è¯­å¥æ•è·ã€‚

è¿™ç§å‡½æ•°ä½“å†…æ•è·é”™è¯¯çš„æœºåˆ¶ï¼Œå¤§å¤§æ–¹ä¾¿äº†å¯¹é”™è¯¯çš„å¤„ç†ã€‚å¤šä¸ª `yield` è¡¨è¾¾å¼ï¼Œå¯ä»¥åªç”¨ä¸€ä¸ª `try...catch` ä»£ç å—æ¥æ•è·é”™è¯¯ã€‚å¦‚æœä½¿ç”¨å›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œæƒ³è¦æ•è·å¤šä¸ªé”™è¯¯ï¼Œå°±ä¸å¾—ä¸ä¸ºæ¯ä¸ªå‡½æ•°å†…éƒ¨å†™ä¸€ä¸ªé”™è¯¯å¤„ç†è¯­å¥ï¼Œç°åœ¨åªåœ¨ Generator å‡½æ•°å†…éƒ¨å†™ä¸€æ¬¡ `catch` è¯­å¥å°±å¯ä»¥äº†ï¼šåœ¨ Generator å‡½æ•°ä¸­å†™ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œä¸æ–­æ¥æ”¶é”™è¯¯ã€‚æ¯”å¦‚ï¼š

```javascript
var g = function* () {
  while (true) {
    yield
    console.log('å†…éƒ¨æ•è·', e)
  }
}

var i = g()
```

è¿˜æœ‰ï¼Œå¦‚æœåœ¨ Generator å‡½æ•°ä¸­æ²¡æœ‰éƒ¨ç½² `try...catch` ä»£ç å—ï¼Œé‚£ä¹ˆä½¿ç”¨ `throw` ä¼šè¢«å¤–éƒ¨çš„ `catch` æ•è·ï¼Œå¦‚æœå¤–éƒ¨ä¹Ÿæ²¡æœ‰éƒ¨ç½²ï¼Œå½“ç„¶å°±æ˜¯ç›´æ¥æŠ¥é”™å•¦~

æ­¤å¤–ï¼Œ`throw` æ–¹æ³•è¢«æ•è·ä»¥åï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸‹ä¸€æ¡ `yield` è¡¨è¾¾å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šé™„å¸¦æ‰§è¡Œä¸€æ¬¡ `next` æ–¹æ³•ã€‚

---

### Generator.prototype.return()

> Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªreturnæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚

```javascript
function* gen() {
  yield 1
  yield 2
  yield 3
}

var g = gen()

g.next()        // { value: 1, done: false }
g.return('foo') // { value: "foo", done: true }
g.next()        // { value: undefined, done: true }
```

å¦‚æœ `return` æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¸æä¾›å‚æ•°ï¼Œåˆ™è¿”å›å€¼çš„ `value` å±æ€§ä¸º `undefined`ï¼š

```javascript
function* gen() {
  yield 1
  yield 2
  yield 3
}

var g = gen()

g.next()        // { value: 1, done: false }
g.return() // { value: undefined, done: true }
```