### æœ‰å…³ JSON

JSON æ ¼å¼ï¼ˆ JavaScript Object Notation çš„ç¼©å†™ ï¼‰æ˜¯ä¸€ç§ç”¨äºæ•°æ®äº¤æ¢çš„æ–‡æœ¬æ ¼å¼ï¼Œ2001å¹´ç”± Douglas Crockford æå‡ºï¼Œç›®çš„æ˜¯å–ä»£ç¹çç¬¨é‡çš„ XML æ ¼å¼ã€‚

ç›¸æ¯” XML æ ¼å¼ï¼ŒJSON æ ¼å¼æœ‰ä¸¤ä¸ªæ˜¾è‘—çš„ä¼˜ç‚¹ï¼šä¹¦å†™ç®€å•ï¼Œä¸€ç›®äº†ç„¶ï¼›ç¬¦åˆ JavaScript åŸç”Ÿè¯­æ³•ï¼Œå¯ä»¥ç”±è§£é‡Šå¼•æ“ç›´æ¥å¤„ç†ï¼Œä¸ç”¨å¦å¤–æ·»åŠ è§£æä»£ç ã€‚æ‰€ä»¥ï¼ŒJSON è¿…é€Ÿè¢«æ¥å—ï¼Œå·²ç»æˆä¸ºå„å¤§ç½‘ç«™äº¤æ¢æ•°æ®çš„æ ‡å‡†æ ¼å¼ï¼Œå¹¶è¢«å†™å…¥ ECMAScript 5ï¼Œæˆä¸ºæ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚

ç®€å•è¯´ï¼Œæ¯ä¸ª JSON å¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªå€¼ã€‚è¦ä¹ˆæ˜¯ç®€å•ç±»å‹çš„å€¼ï¼Œè¦ä¹ˆæ˜¯å¤åˆç±»å‹çš„å€¼ï¼Œä½†æ˜¯åªèƒ½æ˜¯ä¸€ä¸ªå€¼ï¼Œä¸èƒ½æ˜¯ä¸¤ä¸ªæˆ–æ›´å¤šçš„å€¼ã€‚è¿™å°±æ˜¯è¯´ï¼Œæ¯ä¸ª JSON æ–‡æ¡£åªèƒ½åŒ…å«ä¸€ä¸ªå€¼ã€‚

### JSON æ ¼å¼

JSON å¯¹å€¼çš„ç±»å‹å’Œæ ¼å¼æœ‰ä¸¥æ ¼çš„è§„å®šï¼š

> å¤åˆç±»å‹çš„å€¼åªèƒ½æ˜¯æ•°ç»„æˆ–å¯¹è±¡ï¼Œä¸èƒ½æ˜¯å‡½æ•°ã€æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€æ—¥æœŸå¯¹è±¡ã€‚
>
> ç®€å•ç±»å‹çš„å€¼åªæœ‰å››ç§ï¼šå­—ç¬¦ä¸²ã€æ•°å€¼ï¼ˆå¿…é¡»ä»¥åè¿›åˆ¶è¡¨ç¤ºï¼‰ã€å¸ƒå°”å€¼å’Œ nullï¼ˆä¸èƒ½ä½¿ç”¨ NaN, Infinity, -Infinity å’Œ undefinedï¼‰ã€‚
>
> å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨**åŒå¼•å·**è¡¨ç¤ºï¼Œä¸èƒ½ä½¿ç”¨**å•å¼•å·**ã€‚
>
> å¯¹è±¡çš„é”®åå¿…é¡»æ”¾åœ¨**åŒå¼•å·**é‡Œé¢ã€‚
>
> æ•°ç»„æˆ–å¯¹è±¡æœ€åä¸€ä¸ªæˆå‘˜çš„åé¢ï¼Œ**ä¸èƒ½åŠ é€—å·**ã€‚

ES5 æ–°å¢äº† JSON å¯¹è±¡ï¼Œç”¨æ¥å¤„ç† JSON æ ¼å¼æ•°æ®ã€‚å®ƒæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š`JSON.stringify()` å’Œ `JSON.parse()`ã€‚

### JSON.stringify()

> å°†ä¸€ä¸ªå€¼è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¯¥å­—ç¬¦ä¸²ç¬¦åˆ JSON æ ¼å¼ï¼Œå¹¶ä¸”å¯ä»¥è¢« `JSON.parse` æ–¹æ³•è¿˜åŸã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºåŸå§‹ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ç»“æœä¼šå¸¦åŒå¼•å·ã€‚è¿™æ˜¯å› ä¸ºå°†æ¥è¿˜åŸçš„æ—¶å€™ï¼ŒåŒå¼•å·å¯ä»¥è®© JavaScript å¼•æ“çŸ¥é“ï¼Œè¯¥å€¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå˜é‡åã€‚

å¹¶ä¸” `JSON.stringify()` æ–¹æ³•ä¼šå¿½ç•¥å¯¹è±¡çš„ä¸å¯éå†å±æ€§ã€‚

```javascript
JSON.stringify('abc') // ""abc""
JSON.stringify(1) // "1"
JSON.stringify(false) // "false"
JSON.stringify([]) // "[]"
JSON.stringify({}) // "{}"

JSON.stringify([1, "false", false])
// '[1,"false",false]'

JSON.stringify({ name: "å¼ ä¸‰" })
// '{"name":"å¼ ä¸‰"}'
```

å¦‚æœã€ŒåŸå§‹å¯¹è±¡ã€ä¸­ï¼Œæœ‰ä¸€ä¸ªæˆå‘˜çš„å€¼æ˜¯ undefinedã€å‡½æ•°æˆ– XML å¯¹è±¡ï¼Œè¿™ä¸ªæˆå‘˜ä¼šè¢«è¿‡æ»¤ã€‚

```javascript
var obj = {
  a: undefined,
  b: function () {}
}

JSON.stringify(obj) // "{}"
```

å¦‚æœã€Œæ•°ç»„ã€çš„æˆå‘˜æ˜¯ undefinedã€å‡½æ•°æˆ– XML å¯¹è±¡ï¼Œåˆ™è¿™äº›å€¼è¢«è½¬æˆ nullã€‚

```javascript
var arr = [undefined, function () {}]
JSON.stringify(arr) // "[null,null]"
```

æ­£åˆ™å¯¹è±¡ä¼šè¢«è½¬æˆç©ºå¯¹è±¡ã€‚

```javascript
JSON.stringify(/foo/) // "{}"
```

#### JSON.stringify() çš„ç¬¬äºŒä¸ªå‚æ•°

`JSON.stringify()` æ–¹æ³•è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªæ•°ç»„ï¼Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼ŒæŒ‡å®šéœ€è¦è½¬æˆå­—ç¬¦ä¸²çš„å±æ€§ã€‚

è¿™ä¸ªç±»ä¼¼ã€Œ**ç™½åå•**ã€çš„æ•°ç»„ï¼Œåªå¯¹å¯¹è±¡çš„å±æ€§æœ‰æ•ˆï¼Œå¯¹æ•°ç»„æ— æ•ˆã€‚

```javascript
var obj = {
  'prop1': 'value1',
  'prop2': 'value2',
  'prop3': 'value3'
}

var selectedProperties = ['prop1', 'prop2']

JSON.stringify(obj, selectedProperties)
```

æ­¤å¤–ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª**å‡½æ•°**ï¼Œç”¨æ¥æ›´æ”¹ `JSON.stringify()` çš„é»˜è®¤è¡Œä¸ºã€‚

è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯è¢«è½¬æ¢çš„å¯¹è±¡çš„**é”®å**å’Œ**é”®å€¼**ã€‚

æ³¨æ„ï¼Œè¿™ä¸ªå¤„ç†å‡½æ•°æ˜¯é€’å½’å¤„ç†**æ‰€æœ‰çš„é”®**ã€‚

```javascript
function f(key, value) {
  if (typeof value === "number") {
    value = 2 * value
  }
  return value
}

JSON.stringify({ a: 1, b: 2 }, f)
// '{"a": 2,"b": 4}'

function f(key, value) {
  if (typeof(value) === "string") {
    return undefined
  }
  return value
}

JSON.stringify({ a: "abc", b: 123 }, f)
// '{"b": 123}'
```

#### JSON.stringify() çš„ç¬¬ä¸‰ä¸ªå‚æ•°

`JSON.stringify()` è¿˜å¯ä»¥æ¥å—ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºå¢åŠ è¿”å›çš„ JSON å­—ç¬¦ä¸²çš„å¯è¯»æ€§ã€‚å¦‚æœæ˜¯æ•°å­—ï¼Œè¡¨ç¤ºæ¯ä¸ªå±æ€§å‰é¢æ·»åŠ çš„ç©ºæ ¼ï¼ˆ æœ€å¤šä¸è¶…è¿‡ 10 ä¸ª ï¼‰ï¼›å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼ˆ ä¸è¶…è¿‡ 10 ä¸ªå­—ç¬¦ ï¼‰ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²ä¼šæ·»åŠ åœ¨æ¯è¡Œå‰é¢ã€‚

æ„Ÿè§‰ä¸å¸¸ç”¨å‘€ ğŸ˜—

```javascript
/* æ·»åŠ ç©ºæ ¼ */
JSON.stringify({ p1: 1, p2: 2 }, null, 2)
/*
"{
  "p1": 1,
  "p2": 2
}"
*/

/* æ·»åŠ å­—ç¬¦ä¸² */
JSON.stringify({ p1:1, p2:2 }, null, '|-')
/*
"{
|-"p1": 1,
|-"p2": 2
}"
*/
```

#### toJSON æ–¹æ³•

å¦‚æœå¯¹è±¡æœ‰è‡ªå®šä¹‰çš„ `toJSON()` æ–¹æ³•ï¼Œé‚£ä¹ˆ `JSON.stringify()` ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„ã€Œè¿”å›å€¼ã€ä½œä¸º**å‚æ•°**ï¼Œè€Œå¿½ç•¥åŸå¯¹è±¡çš„å…¶ä»–å±æ€§ã€‚

```javascript
var user = {
  firstName: 'ä¸‰',
  lastName: 'å¼ ',

  get fullName(){
    return this.lastName + this.firstName
  },

  toJSON: function () {
    var data = {
      firstName: this.firstName,
      lastName: this.lastName
    }
    return data
  }
}

JSON.stringify(user)
// "{"firstName":"ä¸‰","lastName":"å¼ "}"
```

å†æ¯”å¦‚ï¼Œ**Date** å¯¹è±¡å°±æœ‰ä¸€ä¸ªè‡ªå·±çš„ `toJSON` æ–¹æ³•ã€‚

```javascript
(new Date()).toJSON()
// "2018-01-12T08:19:09.063Z"
```

---

### JSON.parse()

> å°† JSON å­—ç¬¦ä¸²è½¬åŒ–æˆå¯¹è±¡ã€‚

å¦‚æœä¼ å…¥çš„å­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ï¼Œ`JSON.parse()` æ–¹æ³•å°†æŠ¥é”™ã€‚

æ‰€ä»¥ä¸ºäº†å¤„ç†è§£æé”™è¯¯ï¼Œå¯ä»¥å°† `JSON.parse()` æ–¹æ³•æ”¾åœ¨ `try...catch` ä»£ç å—ä¸­ã€‚

```javascript
JSON.parse('{}') // {}
JSON.parse('true') // true
JSON.parse('"foo"') // "foo"
JSON.parse('[1, 5, "false"]') // [1, 5, "false"]
JSON.parse('null') // null

var o = JSON.parse('{"name": "å¼ ä¸‰"}')
o.name // å¼ ä¸‰

/* ä¸ç¬¦åˆ JSON æ ¼å¼ */
JSON.parse("'String'") // illegal single quotes
// SyntaxError: Unexpected token ILLEGAL
```

`JSON.parse` æ–¹æ³•å¯ä»¥æ¥å—ä¸€ä¸ªå¤„ç†å‡½æ•°ï¼Œç”¨æ³•ä¸ `JSON.stringify()` æ–¹æ³•ç±»ä¼¼ã€‚

```javascript
function f(key, value) {
  if (key === ''){
    return value
  }
  if (key === 'a') {
    return value + 10
  }
}

var o = JSON.parse('{"a":1,"b":2}', f)
o.a // 11
o.b // undefined
```