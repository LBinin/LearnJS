### æ¦‚è¿°

æœ¬è´¨ä¸Šï¼Œã€Œ**webpack**ã€æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„**é™æ€æ¨¡å—æ‰“åŒ…å™¨**ï¼ˆ module bundler ï¼‰ã€‚

å½“ **webpack** å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ï¼ˆ dependency graph ï¼‰ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„**æ¯ä¸ªæ¨¡å—**ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—ã€Œæ‰“åŒ…ã€æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚

â—ï¸ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œé™¤äº†ç‰¹åˆ«è¯´æ˜ï¼Œä»¥ä¸‹æ‰€æœ‰ä»£ç éƒ½æ˜¯åœ¨ **webpack** çš„é…ç½®æ–‡ä»¶ `webpack.config.js` ä¸­ä¹¦å†™çš„ã€‚

---

### æ¦‚å¿µ

**webpack** çš„å››ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š

1. å…¥å£ï¼ˆ entry ï¼‰
1. è¾“å‡ºï¼ˆ output ï¼‰
1. loader
1. æ’ä»¶ï¼ˆ plugins ï¼‰

---

#### 1. å…¥å£ï¼ˆ entry ï¼‰

> å…¥å£èµ·ç‚¹ï¼ˆ entry point ï¼‰æŒ‡ç¤º **webpack** åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚

åœ¨è¿›å…¥å…¥å£èµ·ç‚¹ä¹‹åï¼Œ**webpack** ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯**å…¥å£èµ·ç‚¹**ï¼ˆ ç›´æ¥å’Œé—´æ¥ ï¼‰æ‰€ä¾èµ–çš„ã€‚


å¯ä»¥é€šè¿‡åœ¨ **webpack** é…ç½®ä¸­é…ç½® `entry` å±æ€§ï¼Œæ¥æŒ‡å®šä¸€ä¸ªå…¥å£èµ·ç‚¹ï¼ˆ æˆ–å¤šä¸ªå…¥å£èµ·ç‚¹ ï¼‰ã€‚

ä¸¾ä¸€ä¸ª **webpack** çš„ä¾‹å­ï¼š

```javascript
module.exports = {
  entry: {
    main: './path/to/my/entry/file.js'
  }
}

// ç®€å†™åç­‰åŒäº
module.exports = {
  entry: './path/to/my/entry/file.js'
}
```

**# å¤šé¡µé¢åº”ç”¨ç¨‹åº**

åœ¨å¤šé¡µåº”ç”¨ä¸­ï¼Œæ¯å½“é¡µé¢è·³è½¬æ—¶ï¼ŒæœåŠ¡å™¨å°†ä¸ºä½ è·å–ä¸€ä¸ªæ–°çš„ HTML æ–‡æ¡£ã€‚é¡µé¢ä¼šé‡æ–°åŠ è½½æ–°æ–‡æ¡£ï¼Œå¹¶ä¸”èµ„æºè¢«é‡æ–°ä¸‹è½½ã€‚ç„¶è€Œï¼Œè¿™ç»™äº†æˆ‘ä»¬ç‰¹æ®Šçš„æœºä¼šå»åšå¾ˆå¤šäº‹ã€‚

æ¯”å¦‚ä½¿ç”¨ [CommonsChunkPlugin](https://www.webpackjs.com/plugins/commons-chunk-plugin/#src/components/Sidebar/Sidebar.jsx) ä¸ºæ¯ä¸ªé¡µé¢é—´çš„åº”ç”¨ç¨‹åºå…±äº«ä»£ç åˆ›å»º bundleã€‚ç”±äºå…¥å£èµ·ç‚¹å¢å¤šï¼Œå¤šé¡µåº”ç”¨èƒ½å¤Ÿå¤ç”¨å…¥å£èµ·ç‚¹ä¹‹é—´çš„å¤§é‡ä»£ç  / æ¨¡å—ï¼Œä»è€Œå¯ä»¥æå¤§åœ°ä»è¿™äº›æŠ€æœ¯ä¸­å—ç›Šã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```javascript
const config = {
  entry: {
    pageOne: './src/pageOne/index.js',
    pageTwo: './src/pageTwo/index.js',
    pageThree: './src/pageThree/index.js'
  }
}
```

ä¸Šé¢çš„ä»£ç è¡¨ç¤º webpack éœ€è¦ 3 ä¸ªç‹¬ç«‹åˆ†ç¦»çš„ä¾èµ–å›¾ã€‚

---

#### 2. å‡ºå£ï¼ˆ output ï¼‰

> `output` å±æ€§å‘Šè¯‰ **webpack** åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ **bundles**ï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ã€‚

ä½ å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­æŒ‡å®š**ä¸€ä¸ª** output å­—æ®µï¼Œæ¥é…ç½®è¿™äº›å¤„ç†è¿‡ç¨‹ã€‚

**# ç”¨æ³•**

output å±æ€§çš„å€¼éœ€è¦è®¾ç½®ä¸ºä¸€ä¸ª [é…ç½®å¯¹è±¡](https://www.webpackjs.com/configuration/output/)ï¼Œæœ€å°‘éœ€è¦é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

- `filename`ï¼šè¾“å‡ºæ–‡ä»¶çš„ã€Œæ–‡ä»¶åã€ã€‚
- `path`ï¼šè¾“å‡ºæ–‡ä»¶çš„ã€Œç»å¯¹è·¯å¾„ã€ã€‚

é€šè¿‡ `output.filename` å’Œ `output.path` å±æ€§ï¼Œæ¥å‘Šè¯‰ `webpack bundle` çš„åç§°ï¼Œä»¥åŠæˆ‘ä»¬æƒ³è¦å°†å…¶ç”Ÿæˆï¼ˆ emit ï¼‰åˆ°å“ªé‡Œã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```javascript
module.exports = {
  output: {
    filename: 'bundle.js',
    path: '/home/proj/public/assets'
  }
}
```

ä¸Šé¢ä»£ç è¡¨ç¤ºå°†ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ `bundle.js` ç”Ÿäº§åˆ° `/home/proj/public/assets` ç›®å½•ä¸­ã€‚

**# å¤šä¸ªå…¥å£èµ·ç‚¹**

å¦‚æœé…ç½®åˆ›å»ºäº†å¤šä¸ªå•ç‹¬çš„ã€Œchunkã€ï¼ˆ ä¾‹å¦‚ï¼Œä½¿ç”¨å¤šä¸ªå…¥å£èµ·ç‚¹æˆ–ä½¿ç”¨åƒ CommonsChunkPlugin è¿™æ ·çš„æ’ä»¶ ï¼‰ï¼Œåˆ™åº”è¯¥ä½¿ç”¨å ä½ç¬¦( substitutions )æ¥ç¡®ä¿æ¯ä¸ªæ–‡ä»¶å…·æœ‰å”¯ä¸€çš„åç§°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```javascript
{
  entry: {
    app: './src/app.js',
    search: './src/search.js'
  },
  output: {
    filename: '[name].js',
    path: __dirname + '/dist'
  }
}
```

ä¸Šé¢çš„ä»£ç è¡¨ç¤ºå°†ä¼šç”Ÿæˆ `app.js` å’Œ `search.js` ä¸¤ä¸ªæ–‡ä»¶åˆ° `./dist` ç›®å½•ä¸­ã€‚

---

#### 3. loader

**loader** è®© **webpack** èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆ **webpack** è‡ªèº«åªç†è§£ JavaScript ï¼‰ã€‚

**loader** å¯ä»¥å°†ã€Œæ‰€æœ‰ç±»å‹ã€çš„æ–‡ä»¶è½¬æ¢ä¸º **webpack** èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆæ¨¡å—ï¼ˆ ç›¸å½“äºæŠŠå…¶ä»–ä¸åŒçš„è¯­è¨€è½¬æ¢ä¸º JavaScript ï¼‰ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ **webpack** çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚

- **å®‰è£…ç›¸å¯¹åº”çš„ loader**

    åœ¨ä½¿ç”¨å‰ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…ç›¸åº”çš„ **loader**ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦ **webpack** åŠ è½½ CSS æ–‡ä»¶ï¼Œæˆ–è€…å°† TypeScript è½¬ä¸º JavaScriptï¼Œåˆ™éœ€è¦å®‰è£… `css-loader` ä»¥åŠ `ts-loader`ï¼š

    ```bash
    $ npm i --save-dev css-loader
    $ npm i --save-dev ts-loader
    ```

- **é…ç½®**

    å½“æˆ‘ä»¬å®‰è£…å¥½å¯¹åº”çš„ loader çš„æ—¶å€™ï¼Œéœ€è¦å‘Šè¯‰ **webpack** å¯¹æ¯ä¸ªæ–‡ä»¶åä¸º `.css` çš„æ–‡ä»¶ä½¿ç”¨ **css-loader**ï¼Œä»¥åŠå¯¹æ‰€æœ‰åä¸º `.ts` çš„æ–‡ä»¶ä½¿ç”¨ `ts-loader`ï¼š

    ```javascript
    module.exports = {
      module: {
        rules: [
          { test: /\.css$/, use: 'css-loader' },
          { test: /\.ts$/, use: 'ts-loader' }
        ]
      }
    }
    ```

    **éœ€è¦æ³¨æ„çš„æ˜¯**ï¼šåœ¨ **webpack** é…ç½®ä¸­å®šä¹‰ loader æ—¶ï¼Œè¦å®šä¹‰åœ¨è¾“å‡ºå¯¹è±¡çš„ `module.rules` ä¸­ï¼Œè€Œä¸æ˜¯ `rules`ã€‚

    åœ¨ä»¥ä¸Šé…ç½®ä¸­ï¼Œå¯¹ä¸€ä¸ªå•ç‹¬çš„ `module` å¯¹è±¡å®šä¹‰äº† `rules` å±æ€§ï¼Œé‡Œé¢åŒ…å«å¿…é¡»ä»¥ä¸‹ä¸¤ä¸ªå±æ€§ï¼š

    - `test`ï¼šè¯†åˆ«å‡ºåº”è¯¥è¢«å¯¹åº”çš„ loader è¿›è¡Œè½¬æ¢çš„é‚£äº›æ–‡ä»¶ã€‚
    - `use`ï¼šåˆ©ç”¨å¯¹åº”çš„ loader è½¬æ¢è¿™äº›æ–‡ä»¶ï¼Œä»è€Œä½¿å…¶èƒ½å¤Ÿè¢«æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­ï¼ˆ å¹¶ä¸”æœ€ç»ˆæ·»åŠ åˆ° bundle ä¸­ ï¼‰ã€‚

    è¿™ç›¸å½“äºå‘Šè¯‰ webpack ç¼–è¯‘å™¨ï¼ˆ compiler ï¼‰å¦‚ä¸‹ä¿¡æ¯ï¼š

    > ã€ å˜¿ï¼Œwebpack ç¼–è¯‘å™¨ï¼Œå½“ä½ ç¢°åˆ°ã€Œåœ¨ require()/import è¯­å¥ä¸­è¢«è§£æä¸º '.css' çš„è·¯å¾„ã€æ—¶ï¼Œåœ¨ä½ å¯¹å®ƒæ‰“åŒ…ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ css-loader è½¬æ¢ä¸€ä¸‹ã€‚ ã€

- **ä½¿ç”¨**

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ä½¿ç”¨ loader çš„æ–¹å¼ï¼š

- é…ç½®ï¼ˆ ğŸ‘ˆğŸ» **æ¨è** ï¼‰ï¼šåœ¨ `webpack.config.js` æ–‡ä»¶ä¸­æŒ‡å®š loaderã€‚

    é…ç½®æ–¹æ³•å·²ç»åœ¨ä¸Šé¢ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚

- å†…è”ï¼šåœ¨æ¯ä¸ª `import` è¯­å¥ä¸­æ˜¾å¼æŒ‡å®š loaderã€‚

    å¯ä»¥åœ¨ `import` è¯­å¥æˆ–ä»»ä½•ç­‰æ•ˆäº `import` çš„æ–¹å¼ä¸­æŒ‡å®š loaderã€‚
    
    ä½¿ç”¨ `!` å°†èµ„æºä¸­çš„ loader åˆ†å¼€ã€‚åˆ†å¼€çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ç›¸å¯¹äºå½“å‰ç›®å½•è§£æã€‚

    ```javascript
    import Styles from 'style-loader!css-loader?modules!./styles.css'
    ```

    è¯´å®è¯ï¼Œçœ‹åˆ°ä¸Šé¢çš„å¥å­ï¼Œæˆ‘å°±å†³å®šäº†å°½å¯èƒ½ä½¿ç”¨ `module.rules` ğŸŒš 
    
    å› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘æºç ä¸­çš„ä»£ç é‡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡ºé”™æ—¶ï¼Œæ›´å¿«åœ°è°ƒè¯•å’Œå®šä½ loader ä¸­çš„é—®é¢˜ã€‚

- CLIï¼šåœ¨ **shell** å‘½ä»¤ä¸­æŒ‡å®šå®ƒä»¬ã€‚

    ```bash
    webpack --module-bind jade-loader --module-bind 'css=style-loader!css-loader'
    ```

    è¿™ä¼šå¯¹ `.jade` æ–‡ä»¶ä½¿ç”¨ `jade-loader`ï¼Œå¯¹ `.css` æ–‡ä»¶ä½¿ç”¨ `style-loader` å’Œ `css-loader`ã€‚

- **Loader ç‰¹æ€§**

    - loader æ”¯æŒé“¾å¼ä¼ é€’ã€‚èƒ½å¤Ÿå¯¹èµ„æºä½¿ç”¨æµæ°´çº¿( pipeline )ã€‚

        ä¸€ç»„é“¾å¼çš„ loader å°†æŒ‰ç…§ç›¸åçš„é¡ºåºæ‰§è¡Œã€‚loader é“¾ä¸­çš„ç¬¬ä¸€ä¸ª loader è¿”å›å€¼ç»™ä¸‹ä¸€ä¸ª loaderã€‚åœ¨æœ€åä¸€ä¸ª loaderï¼Œè¿”å› webpack æ‰€é¢„æœŸçš„ JavaScriptã€‚

    - loader å¯ä»¥æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚
    - loader è¿è¡Œåœ¨ **Node.js** ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ‰§è¡Œä»»ä½•å¯èƒ½çš„æ“ä½œã€‚
    - loader æ¥æ”¶æŸ¥è¯¢å‚æ•°ã€‚ç”¨äºå¯¹ loader ä¼ é€’é…ç½®ã€‚
    - loader ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ options å¯¹è±¡è¿›è¡Œé…ç½®ã€‚
    - é™¤äº†ä½¿ç”¨ `package.json` å¸¸è§çš„ `main` å±æ€§ï¼Œè¿˜å¯ä»¥å°†æ™®é€šçš„ npm æ¨¡å—å¯¼å‡ºä¸º loaderï¼Œåšæ³•æ˜¯åœ¨ `package.json` é‡Œå®šä¹‰ä¸€ä¸ª `loader` å­—æ®µã€‚
    - æ’ä»¶( plugin )å¯ä»¥ä¸º loader å¸¦æ¥æ›´å¤šç‰¹æ€§ã€‚
    - loader èƒ½å¤Ÿäº§ç”Ÿé¢å¤–çš„ä»»æ„æ–‡ä»¶ã€‚
    - loader é€šè¿‡ï¼ˆ loader ï¼‰é¢„å¤„ç†å‡½æ•°ï¼Œä¸º JavaScript ç”Ÿæ€ç³»ç»Ÿæä¾›äº†æ›´å¤šèƒ½åŠ›ã€‚ ç”¨æˆ·ç°åœ¨å¯ä»¥æ›´åŠ çµæ´»åœ°å¼•å…¥ç»†ç²’åº¦é€»è¾‘ï¼Œä¾‹å¦‚å‹ç¼©ã€æ‰“åŒ…ã€è¯­è¨€ç¿»è¯‘å’Œå…¶ä»–æ›´å¤šã€‚

---

### 4. æ’ä»¶ï¼ˆ plugin ï¼‰

å‰é¢æˆ‘ä»¬è¯´åˆ°çš„ loaderï¼Œå¯ä»¥è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œã€Œæ’ä»¶ã€åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚

æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼šä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚

æ’ä»¶æ¥å£åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚

æƒ³è¦ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œä½ åªéœ€è¦ `require()` å®ƒï¼Œç„¶åæŠŠå®ƒæ·»åŠ åˆ° `plugins` æ•°ç»„ä¸­ã€‚å¤šæ•°æ’ä»¶å¯ä»¥é€šè¿‡é€‰é¡¹( option )è‡ªå®šä¹‰ã€‚

ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­å› ä¸ºä¸åŒç›®çš„è€Œå¤šæ¬¡ä½¿ç”¨åŒä¸€ä¸ªæ’ä»¶ï¼Œè¿™æ—¶éœ€è¦é€šè¿‡ä½¿ç”¨ `new` æ“ä½œç¬¦æ¥åˆ›å»ºæ’ä»¶çš„ä¸€ä¸ªå®ä¾‹ã€‚

```javascript
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin') // é€šè¿‡ npm å®‰è£…
const webpack = require('webpack') // ç”¨äºè®¿é—®å†…ç½®æ’ä»¶
const path = require('path')

const config = {
  entry: './path/to/my/entry/file.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'my-first-webpack.bundle.js'
  },
  module: {
    rules: [
      { test: /\.txt$/, use: 'raw-loader' }
    ]
  },
  plugins: [
    new webpack.optimize.UglifyJsPlugin(),
    new HtmlWebpackPlugin({template: './src/index.html'})
  ]
}

module.exports = config
```